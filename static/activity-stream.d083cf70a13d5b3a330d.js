(()=>{var e,t,s,n={747:(e,t,s)=>{var n={"./en-US":[5005,745],"./en-US/":[5005,745],"./en-US/index":[5005,745],"./en-US/index.js":[5005,745],"./zh-CN":[8047,822],"./zh-CN/":[8047,822],"./zh-CN/index":[8047,822],"./zh-CN/index.js":[8047,822]};function o(e){if(!s.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],o=t[0];return s.e(t[1]).then((()=>s(o)))}o.keys=()=>Object.keys(n),o.id=747,e.exports=o},8059:(e,t,s)=>{"use strict";var n=s(43),o=s(391),i=s(8092);async function r(e,t){const n=new o.Yk([e]),i=await Promise.all(t.map((t=>async function(e,t){const n=await s(747)(`./${e}`);return new o.WZ(n[t])}(e,t))));for(const e of i)n.addResource(e);return n}const a={available:(c=document.head).querySelector('meta[name="availableLanguages"]').getAttribute("content").split(",").map((e=>e.trim())),default:c.querySelector('meta[name="defaultLanguage"]').getAttribute("content")};var c;const l=function(e){return Array.prototype.map.call(e.querySelectorAll('link[rel="localization"]'),(e=>e.getAttribute("href")))}(document.head);document.l10n=new i.f(l,(async function*(e){const t=(0,n.R)(navigator.languages,a.available,{defaultLocale:a.default});for(const s of t)yield r(s,e)})),window.addEventListener("languagechange",document.l10n),document.l10n.ready=function(){const e=document.readyState;return"interactive"===e||"completed"===e?Promise.resolve():new Promise((e=>document.addEventListener("readystatechange",e,{once:!0})))}().then((()=>(document.l10n.connectRoot(document.documentElement),document.l10n.translateRoots()))),s(4109),s(8451),s(7341);const p="ActivityStream:Main",d="ActivityStream:Content",h="ActivityStream:PreloadedBrowser",m="undefined"==typeof Window?2:1,u={};for(const e of["ABOUT_SPONSORED_TOP_SITES","ADDONS_INFO_REQUEST","ADDONS_INFO_RESPONSE","ARCHIVE_FROM_POCKET","AS_ROUTER_INITIALIZED","AS_ROUTER_PREF_CHANGED","AS_ROUTER_TARGETING_UPDATE","AS_ROUTER_TELEMETRY_USER_EVENT","BLOCK_URL","BOOKMARK_URL","CLEAR_PREF","COPY_DOWNLOAD_LINK","DELETE_BOOKMARK_BY_ID","DELETE_FROM_POCKET","DELETE_HISTORY_URL","DIALOG_CANCEL","DIALOG_OPEN","DISABLE_SEARCH","DISCOVERY_STREAM_COLLECTION_DISMISSIBLE_TOGGLE","DISCOVERY_STREAM_CONFIG_CHANGE","DISCOVERY_STREAM_CONFIG_RESET","DISCOVERY_STREAM_CONFIG_RESET_DEFAULTS","DISCOVERY_STREAM_CONFIG_SETUP","DISCOVERY_STREAM_CONFIG_SET_VALUE","DISCOVERY_STREAM_DEV_EXPIRE_CACHE","DISCOVERY_STREAM_DEV_IDLE_DAILY","DISCOVERY_STREAM_DEV_SYNC_RS","DISCOVERY_STREAM_DEV_SYSTEM_TICK","DISCOVERY_STREAM_EXPERIMENT_DATA","DISCOVERY_STREAM_FEEDS_UPDATE","DISCOVERY_STREAM_FEED_UPDATE","DISCOVERY_STREAM_IMPRESSION_STATS","DISCOVERY_STREAM_LAYOUT_RESET","DISCOVERY_STREAM_LAYOUT_UPDATE","DISCOVERY_STREAM_LINK_BLOCKED","DISCOVERY_STREAM_LOADED_CONTENT","DISCOVERY_STREAM_PERSONALIZATION_INIT","DISCOVERY_STREAM_PERSONALIZATION_LAST_UPDATED","DISCOVERY_STREAM_PERSONALIZATION_TOGGLE","DISCOVERY_STREAM_POCKET_STATE_INIT","DISCOVERY_STREAM_POCKET_STATE_SET","DISCOVERY_STREAM_PREFS_SETUP","DISCOVERY_STREAM_RECENT_SAVES","DISCOVERY_STREAM_RETRY_FEED","DISCOVERY_STREAM_SPOCS_CAPS","DISCOVERY_STREAM_SPOCS_ENDPOINT","DISCOVERY_STREAM_SPOCS_PLACEMENTS","DISCOVERY_STREAM_SPOCS_UPDATE","DISCOVERY_STREAM_SPOC_BLOCKED","DISCOVERY_STREAM_SPOC_IMPRESSION","DISCOVERY_STREAM_USER_EVENT","DOWNLOAD_CHANGED","FAKE_FOCUS_SEARCH","FILL_SEARCH_TERM","HANDOFF_SEARCH_TO_AWESOMEBAR","HIDE_PRIVACY_INFO","INIT","MOCOCN_PREFS_INITIAL_VALUES","MOCOCN_PREF_CHANGED","MOCOCN_SET_PREF","NEW_TAB_INIT","NEW_TAB_INITIAL_STATE","NEW_TAB_LOAD","NEW_TAB_REHYDRATED","NEW_TAB_STATE_REQUEST","NEW_TAB_UNLOAD","OPEN_DOWNLOAD_FILE","OPEN_LINK","OPEN_NEW_WINDOW","OPEN_PRIVATE_WINDOW","OPEN_WEBEXT_SETTINGS","PARTNER_LINK_ATTRIBUTION","PLACES_BOOKMARKS_REMOVED","PLACES_BOOKMARK_ADDED","PLACES_HISTORY_CLEARED","PLACES_LINKS_CHANGED","PLACES_LINKS_DELETED","PLACES_LINK_BLOCKED","PLACES_SAVED_TO_POCKET","POCKET_CTA","POCKET_LINK_DELETED_OR_ARCHIVED","POCKET_LOGGED_IN","POCKET_WAITING_FOR_SPOC","PREFS_INITIAL_VALUES","PREF_CHANGED","PREVIEW_REQUEST","PREVIEW_REQUEST_CANCEL","PREVIEW_RESPONSE","REMOVE_DOWNLOAD_FILE","RICH_ICON_MISSING","SAVE_SESSION_PERF_DATA","SAVE_TO_POCKET","SCREENSHOT_UPDATED","SECTION_DEREGISTER","SECTION_DISABLE","SECTION_ENABLE","SECTION_MOVE","SECTION_OPTIONS_CHANGED","SECTION_REGISTER","SECTION_UPDATE","SECTION_UPDATE_CARD","SETTINGS_CLOSE","SETTINGS_OPEN","SET_PREF","SHOW_DOWNLOAD_FILE","SHOW_FIREFOX_ACCOUNTS","SHOW_PRIVACY_INFO","SHOW_SEARCH","SKIPPED_SIGNIN","SNIPPETS_BLOCKLIST_CLEARED","SNIPPETS_BLOCKLIST_UPDATED","SNIPPETS_DATA","SNIPPETS_PREVIEW_MODE","SNIPPETS_RESET","SNIPPET_BLOCKED","SUBMIT_EMAIL","SUBMIT_SIGNIN","SYSTEM_TICK","TELEMETRY_IMPRESSION_STATS","TELEMETRY_USER_EVENT","TOP_SITES_CANCEL_EDIT","TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL","TOP_SITES_EDIT","TOP_SITES_INSERT","TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL","TOP_SITES_ORGANIC_IMPRESSION_STATS","TOP_SITES_PIN","TOP_SITES_PREFS_UPDATED","TOP_SITES_SPONSORED_IMPRESSION_STATS","TOP_SITES_UNPIN","TOP_SITES_UPDATED","TOTAL_BOOKMARKS_REQUEST","TOTAL_BOOKMARKS_RESPONSE","UNINIT","UPDATE_PINNED_SEARCH_SHORTCUTS","UPDATE_SEARCH_SHORTCUTS","UPDATE_SECTION_PREFS","WEBEXT_CLICK","WEBEXT_DISMISS"])u[e]=e;function E(e,t){const s=e.meta?{...e.meta}:{};if(!t||!t.from||!t.to)throw new Error("Routed Messages must have options as the second parameter, and must at least include a .from and .to property.");return["from","to","toTarget","fromTarget","skipMain","skipLocal"].forEach((e=>{void 0!==t[e]?s[e]=t[e]:s[e]&&delete s[e]})),{...e,meta:s}}function S(e,t,s){return E(e,{from:d,to:p,fromTarget:t,skipLocal:s})}function _(e,t,s){if(!t)throw new Error("You must provide a target ID as the second parameter of AlsoToOneContent. If you want to send to all content processes, use BroadcastToContent");return E(e,{from:p,to:d,toTarget:t,skipMain:s})}const g={BroadcastToContent:function(e){return E(e,{from:p,to:d})},UserEvent:function(e){return S({type:u.TELEMETRY_USER_EVENT,data:e})},DiscoveryStreamUserEvent:function(e){return S({type:"function"==typeof OffscreenCanvas?u.DISCOVERY_STREAM_USER_EVENT:u.TELEMETRY_USER_EVENT,data:e})},ASRouterUserEvent:function(e){return S({type:u.AS_ROUTER_TELEMETRY_USER_EVENT,data:e})},ImpressionStats:function(e,t=m){const s={type:u.TELEMETRY_IMPRESSION_STATS,data:e};return 1===t?S(s):s},AlsoToOneContent:_,OnlyToOneContent:function(e,t){return _(e,t,!0)},AlsoToMain:S,OnlyToMain:function(e,t){return S(e,t,!0)},AlsoToPreloaded:function(e){return E(e,{from:p,to:h})},SetPref:function(e,t,s=m){const n={type:u.SET_PREF,data:{name:e,value:t}};return 1===s?S(n):n},WebExtEvent:function(e,t,s=m){if(!t||!t.source)throw new Error('WebExtEvent actions should include a property "source", the id of the webextension that should receive the event.');const n={type:e,data:t};return 1===s?S(n):n},DiscoveryStreamImpressionStats:function(e,t=m){const s={type:u.DISCOVERY_STREAM_IMPRESSION_STATS,data:e};return 1===t?S(s):s},DiscoveryStreamLoadedContent:function(e,t=m){const s={type:u.DISCOVERY_STREAM_LOADED_CONTENT,data:e};return 1===t?S(s):s}},v=e=>!!e.meta&&e.meta.to===p&&e.meta.from===d,f=e=>!!e.meta&&e.meta.to===d&&!e.meta.toTarget,b=e=>!!e.meta&&!(e.meta.to!==d||!e.meta.toTarget),C=e=>!!e.meta&&e.meta.to===h&&e.meta.from===p,y=e=>!!e.meta&&e.meta.from===p&&e.meta.to===d,k=["BLOCK_MESSAGE_BY_ID","USER_ACTION","IMPRESSION","TRIGGER","NEWTAB_MESSAGE_REQUEST","PBNEWTAB_MESSAGE_REQUEST","DOORHANGER_TELEMETRY","TOOLBAR_BADGE_TELEMETRY","TOOLBAR_PANEL_TELEMETRY","MOMENTS_PAGE_TELEMETRY","INFOBAR_TELEMETRY","SPOTLIGHT_TELEMETRY","TOAST_NOTIFICATION_TELEMETRY","AS_ROUTER_TELEMETRY_USER_EVENT","ADMIN_CONNECT_STATE","UNBLOCK_MESSAGE_BY_ID","UNBLOCK_ALL","BLOCK_BUNDLE","UNBLOCK_BUNDLE","DISABLE_PROVIDER","ENABLE_PROVIDER","EVALUATE_JEXL_EXPRESSION","EXPIRE_QUERY_CACHE","FORCE_ATTRIBUTION","FORCE_WHATSNEW_PANEL","FORCE_PRIVATE_BROWSING_WINDOW","CLOSE_WHATSNEW_PANEL","OVERRIDE_MESSAGE","MODIFY_MESSAGE_JSON","RESET_PROVIDER_PREF","SET_PROVIDER_USER_PREF","RESET_GROUPS_STATE"].reduce(((e,t)=>(e[t]=t,e)),{}),O={addListener(e){s.g.ASRouterAddParentListener&&s.g.ASRouterAddParentListener(e)},removeListener(e){s.g.ASRouterRemoveParentListener&&s.g.ASRouterRemoveParentListener(e)},sendMessage:e=>s.g.ASRouterMessage?s.g.ASRouterMessage(e):(s.g.console.error(new Error(`Unexpected call:\n${JSON.stringify(e,null,3)}`)),s.g.Promise.resolve({message:{}})),blockById:(e,t)=>O.sendMessage({type:k.BLOCK_MESSAGE_BY_ID,data:{id:e,...t}}),modifyMessageJson:e=>O.sendMessage({type:k.MODIFY_MESSAGE_JSON,data:{content:e}}),executeAction:e=>O.sendMessage({type:k.USER_ACTION,data:e}),unblockById:e=>O.sendMessage({type:k.UNBLOCK_MESSAGE_BY_ID,data:{id:e}}),blockBundle:e=>O.sendMessage({type:k.BLOCK_BUNDLE,data:{bundle:e}}),unblockBundle:e=>O.sendMessage({type:k.UNBLOCK_BUNDLE,data:{bundle:e}}),overrideMessage:e=>O.sendMessage({type:k.OVERRIDE_MESSAGE,data:{id:e}}),sendTelemetry:e=>O.sendMessage(g.ASRouterUserEvent(e)),getPreviewEndpoint(){if(s.g.document&&s.g.document.location&&s.g.document.location.href.includes("endpoint")){const e=new URLSearchParams(s.g.document.location.href.slice(s.g.document.location.href.indexOf("endpoint")));try{return{url:new URL(e.get("endpoint")).href,snippetId:e.get("snippetId"),theme:this.getPreviewTheme(),dir:this.getPreviewDir()}}catch(e){}}return null},getPreviewTheme:()=>new URLSearchParams(s.g.document.location.href.slice(s.g.document.location.href.indexOf("theme"))).get("theme"),getPreviewDir:()=>new URLSearchParams(s.g.document.location.href.slice(s.g.document.location.href.indexOf("dir"))).get("dir")};var T=s(93);const w={text:["text","scene1_text"],success_text:"success_text",error_text:"error_text",scene2_text:"scene2_text",amo_html:"amo_html",privacy_html:"scene2_privacy_html",disclaimer_html:"scene2_disclaimer_html"},I=Object.keys(w);function N(e){const t=new T.Yk("en-US");return I.forEach((s=>{const n=w[s],o=Array.isArray(n)?[...n]:[n];let i="";for(;!i&&o.length;){const t=o.pop();i=e[t]}t.addMessages(`${s} = ${i}`)})),[t]}var P=s(7294);const R="visible",A="visibilitychange";class D extends P.PureComponent{sendImpressionOrAddListener(){this.props.document.visibilityState===R?this.props.sendImpression({id:this.props.id}):(this._onVisibilityChange&&this.props.document.removeEventListener(A,this._onVisibilityChange),this._onVisibilityChange=()=>{this.props.document.visibilityState===R&&(this.props.sendImpression({id:this.props.id}),this.props.document.removeEventListener(A,this._onVisibilityChange))},this.props.document.addEventListener(A,this._onVisibilityChange))}componentWillUnmount(){this._onVisibilityChange&&this.props.document.removeEventListener(A,this._onVisibilityChange)}componentDidMount(){this.props.sendOnMount&&this.sendImpressionOrAddListener()}componentDidUpdate(e){this.props.shouldSendImpressionOnUpdate(this.props,e)&&this.sendImpressionOrAddListener()}render(){return this.props.children}}D.defaultProps={document:s.g.document,sendOnMount:!0};var L=s(8793);const M=s.g.document&&"https://newtab.firefoxchina.cn"===s.g.document.location.origin,x=s.g.document&&"about:newtab"===s.g.document.documentURI,U={ntp_background:{r:42,g:42,b:46,a:1},ntp_card_background:{r:66,g:65,b:77,a:1},ntp_text:{r:249,g:249,b:250,a:1},sidebar:{r:56,g:56,b:61,a:1},sidebar_text:{r:249,g:249,b:250,a:1}};var B=s(3935);const F=["color","backgroundColor"],K=e=>{const t={};for(const s of F)void 0!==e[s]&&(t[s]=e[s]);return t.backgroundColor&&(t.border="0"),P.createElement("button",{onClick:e.onClick,className:e.className||"ASRouterButton secondary",style:t},e.children)};function V(e){if(!e)return"";const{protocol:t}=new URL(e),s=["http:","https:","data:","resource:","chrome:"].includes(t);return s||console.warn(`The protocol ${t} is not allowed for template URLs.`),s?e:""}function H(){return H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},H.apply(this,arguments)}const W={b:P.createElement("b",null),i:P.createElement("i",null),u:P.createElement("u",null),strong:P.createElement("strong",null),em:P.createElement("em",null),br:P.createElement("br",null)};function j(e){if(!I.includes(e.localization_id))throw new Error(`ASRouter: ${e.localization_id} is not a valid rich text property. If you want it to be processed, you need to add it to asrouter/rich-text-strings.js`);return P.createElement(L.Vd,H({id:e.localization_id},W,e.customElements,function(e,t,s,n=!1){return e?Object.keys(e).reduce(((o,i)=>{const{action:r}=e[i],a=!r&&V(e[i].url);return o[i]=P.createElement("a",{href:a,target:n?"_blank":"","data-metric":e[i].metric,"data-action":r,"data-args":e[i].args,"data-do_not_autoblock":s,"data-entrypoint_name":e[i].entrypoint_name,"data-entrypoint_value":e[i].entrypoint_value,rel:"noreferrer",onClick:t}),o}),{}):null}(e.links,e.sendClick,e.doNotAutoBlock,e.openNewWindow)),P.createElement("span",null,e.text))}class $ extends P.PureComponent{constructor(e){super(e),this.onBlockClicked=this.onBlockClicked.bind(this),this.onDismissClicked=this.onDismissClicked.bind(this),this.setBlockButtonRef=this.setBlockButtonRef.bind(this),this.onBlockButtonMouseEnter=this.onBlockButtonMouseEnter.bind(this),this.onBlockButtonMouseLeave=this.onBlockButtonMouseLeave.bind(this),this.state={blockButtonHover:!1}}componentDidMount(){this.blockButtonRef&&(this.blockButtonRef.addEventListener("mouseenter",this.onBlockButtonMouseEnter),this.blockButtonRef.addEventListener("mouseleave",this.onBlockButtonMouseLeave))}componentWillUnmount(){this.blockButtonRef&&(this.blockButtonRef.removeEventListener("mouseenter",this.onBlockButtonMouseEnter),this.blockButtonRef.removeEventListener("mouseleave",this.onBlockButtonMouseLeave))}setBlockButtonRef(e){this.blockButtonRef=e}onBlockButtonMouseEnter(){this.setState({blockButtonHover:!0})}onBlockButtonMouseLeave(){this.setState({blockButtonHover:!1})}onBlockClicked(){"preview"!==this.props.provider&&this.props.sendUserActionTelemetry({event:"BLOCK",id:this.props.UISurface}),this.props.onBlock()}onDismissClicked(){"preview"!==this.props.provider&&this.props.sendUserActionTelemetry({event:"DISMISS",id:this.props.UISurface}),this.props.onDismiss()}renderDismissButton(){if(this.props.footerDismiss)return P.createElement("div",{className:"footer"},P.createElement("div",{className:"footer-content"},P.createElement("button",{className:"ASRouterButton secondary",onClick:this.onDismissClicked},this.props.content.scene2_dismiss_button_text)));const e=this.props.content.block_button_text||"Remove this";return P.createElement("button",{className:"blockButton",title:e,"aria-label":e,onClick:this.onBlockClicked,ref:this.setBlockButtonRef})}render(){const{props:e}=this,{blockButtonHover:t}=this.state,s=`SnippetBaseContainer${e.className?` ${e.className}`:""}${t?" active":""}`;return P.createElement("div",{className:s,style:this.props.textStyle},P.createElement("div",{className:"innerWrapper"},e.children),this.renderDismissButton())}}function G(){return G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},G.apply(this,arguments)}const Y="chrome://branding/content/icon64.png";class z extends P.PureComponent{constructor(e){super(e),this.onButtonClick=this.onButtonClick.bind(this)}renderText(){const{props:e}=this;return e.content.text?P.createElement(j,{text:e.content.text,customElements:this.props.customElements,localization_id:"text",links:e.content.links,sendClick:e.sendClick}):null}renderTitle(){const{title:e}=this.props.content;return e?P.createElement("h3",{className:"title title-inline"},e,P.createElement("br",null)):null}async onButtonClick(){"preview"!==this.props.provider&&this.props.sendUserActionTelemetry({event:"CLICK_BUTTON",id:this.props.UISurface});const{button_url:e}=this.props.content,t=this.props.content.button_action||e&&"OPEN_URL";await this.props.onAction({type:t,data:{args:this.props.content.button_action_args||e}}),this.props.content.do_not_autoblock||this.props.onBlock()}_shouldRenderButton(){return this.props.content.button_action||this.props.onButtonClick||this.props.content.button_url}renderButton(){const{props:e}=this;return this._shouldRenderButton()?P.createElement(K,{onClick:e.onButtonClick||this.onButtonClick,color:e.content.button_color,backgroundColor:e.content.button_background_color},e.content.button_label):null}render(){const{props:e}=this;let t="SimpleBelowSearchSnippet",s="below-search-snippet";return e.className&&(t+=` ${e.className}`),this._shouldRenderButton()&&(t+=" withButton",s+=" withButton"),P.createElement("div",{className:s},P.createElement("div",{className:"snippet-hover-wrapper"},P.createElement($,G({},e,{className:t,textStyle:this.props.textStyle}),P.createElement("img",{src:V(e.content.icon)||Y,className:"icon icon-light-theme",alt:e.content.icon_alt_text||""}),P.createElement("img",{src:V(e.content.icon_dark_theme||e.content.icon)||Y,className:"icon icon-dark-theme",alt:e.content.icon_alt_text||""}),P.createElement("div",{className:"textContainer"},this.renderTitle(),P.createElement("p",{className:"body"},this.renderText()),this.props.extraContent),P.createElement("div",{className:"buttonContainer"},this.renderButton()))))}}const q=({condition:e,wrap:t,children:s})=>e&&t?t(s):s;function Q(){return Q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Q.apply(this,arguments)}const J="chrome://branding/content/icon64.png";class X extends P.PureComponent{constructor(e){super(e),this.onButtonClick=this.onButtonClick.bind(this)}onButtonClick(){"preview"!==this.props.provider&&this.props.sendUserActionTelemetry({event:"CLICK_BUTTON",id:this.props.UISurface});const{button_url:e,button_entrypoint_value:t,button_entrypoint_name:s}=this.props.content,n=this.props.content.button_action||e&&"OPEN_URL",o=s?new URLSearchParams([[s,t]]).toString():t;this.props.onAction({type:n,data:{args:this.props.content.button_action_args||e,...o&&{entrypoint:o}}}),this.props.content.do_not_autoblock||this.props.onBlock()}_shouldRenderButton(){return this.props.content.button_action||this.props.onButtonClick||this.props.content.button_url}renderTitle(){const{title:e}=this.props.content;return e?P.createElement("h3",{className:"title "+(this._shouldRenderButton()?"title-inline":"")},this.renderTitleIcon()," ",e):null}renderTitleIcon(){const e=V(this.props.content.title_icon),t=V(this.props.content.title_icon_dark_theme||this.props.content.title_icon);return e?P.createElement(P.Fragment,null,P.createElement("span",{className:"titleIcon icon-light-theme",style:{backgroundImage:`url("${e}")`}}),P.createElement("span",{className:"titleIcon icon-dark-theme",style:{backgroundImage:`url("${t}")`}})):null}renderButton(){const{props:e}=this;return this._shouldRenderButton()?P.createElement(K,{onClick:e.onButtonClick||this.onButtonClick,color:e.content.button_color,backgroundColor:e.content.button_background_color},e.content.button_label):null}renderText(){const{props:e}=this;return P.createElement(j,{text:e.content.text,customElements:this.props.customElements,localization_id:"text",links:e.content.links,sendClick:e.sendClick})}wrapSectionHeader(e){return function(t){return P.createElement("a",{href:e},t)}}wrapSnippetContent(e){return P.createElement("div",{className:"innerContentWrapper"},e)}renderSectionHeader(){const{props:e}=this;if(e.content.section_title_icon&&e.content.section_title_text){const t=V(e.content.section_title_icon),s=V(e.content.section_title_icon_dark_theme||e.content.section_title_icon),n=e.content.section_title_url;return P.createElement("div",{className:"section-header"},P.createElement("h3",{className:"section-title"},P.createElement(q,{condition:n,wrap:this.wrapSectionHeader(n)},P.createElement("span",{className:"icon icon-small-spacer icon-light-theme",style:{backgroundImage:`url("${t}")`}}),P.createElement("span",{className:"icon icon-small-spacer icon-dark-theme",style:{backgroundImage:`url("${s}")`}}),P.createElement("span",{className:"section-title-text"},e.content.section_title_text))))}return null}render(){const{props:e}=this,t=this.renderSectionHeader();let s="SimpleSnippet";return e.className&&(s+=` ${e.className}`),e.content.tall&&(s+=" tall"),t&&(s+=" has-section-header"),P.createElement("div",{className:"snippet-hover-wrapper"},P.createElement($,Q({},e,{className:s,textStyle:this.props.textStyle}),t,P.createElement(q,{condition:t,wrap:this.wrapSnippetContent},P.createElement("img",{src:V(e.content.icon)||J,className:"icon icon-light-theme",alt:e.content.icon_alt_text||""}),P.createElement("img",{src:V(e.content.icon_dark_theme||e.content.icon)||J,className:"icon icon-dark-theme",alt:e.content.icon_alt_text||""}),P.createElement("div",null,this.renderTitle()," ",P.createElement("p",{className:"body"},this.renderText()),this.props.extraContent),P.createElement("div",null,this.renderButton()))))}}const Z={simple_snippet:X,simple_below_search_snippet:z};function ee(){return ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},ee.apply(this,arguments)}const te=["simple_below_search_snippet"];function se(e,t){return e.message.id&&(!t.message||t.message.id!==e.message.id)}class ne extends P.PureComponent{constructor(e){super(e),this.sendClick=this.sendClick.bind(this),this.sendImpression=this.sendImpression.bind(this),this.sendUserActionTelemetry=this.sendUserActionTelemetry.bind(this),this.onUserAction=this.onUserAction.bind(this),this.fetchFlowParams=this.fetchFlowParams.bind(this),this.onBlockSelected=this.onBlockSelected.bind(this),this.onBlockById=this.onBlockById.bind(this),this.onDismiss=this.onDismiss.bind(this),this.onMessageFromParent=this.onMessageFromParent.bind(this),this.state={message:{}},e.document&&(this.footerPortal=e.document.getElementById("footer-asrouter-container"))}async fetchFlowParams(e={}){let t={};const{fxaEndpoint:s}=this.props;if(!s){const e="Tried to fetch flow params before fxaEndpoint pref was ready";console.error(e)}try{const n=new URL(s);n.pathname="metrics-flow",Object.keys(e).forEach((t=>{n.searchParams.append(t,e[t])}));const o=await fetch(n.toString(),{credentials:"omit"});if(200===o.status){const{deviceId:e,flowId:s,flowBeginTime:n}=await o.json();t={deviceId:e,flowId:s,flowBeginTime:n}}else console.error("Non-200 response",o)}catch(e){console.error(e)}return t}sendUserActionTelemetry(e={}){const{message:t}=this.state,s=`${t.provider}_user_event`,n=e.id;delete e.id,O.sendTelemetry({source:n,message_id:t.id,action:s,...e})}sendImpression(e){return"preview"===this.state.message.provider?Promise.resolve():(this.sendUserActionTelemetry({event:"IMPRESSION",...e}),O.sendMessage({type:k.IMPRESSION,data:this.state.message}))}sendClick(e){const{dataset:t}=e.target,s={event_context:t.metric,id:"NEWTAB_FOOTER_BAR_CONTENT"},{entrypoint_name:n,entrypoint_value:o}=t,i=n?new URLSearchParams([[n,o]]).toString():o,r={type:t.action,data:{args:t.args,...i&&{entrypoint:i}}};r.type&&O.executeAction(r),this.state.message.content.do_not_autoblock||t.do_not_autoblock||this.onBlockById(this.state.message.id),"preview"!==this.state.message.provider&&this.sendUserActionTelemetry({event:"CLICK_BUTTON",...s})}onBlockSelected(e){return this.onBlockById(this.state.message.id,{...e,campaign:this.state.message.campaign})}onBlockById(e,t){return O.blockById(e,t).then((e=>{e&&this.setState({message:{}})}))}onDismiss(){this.clearMessage(this.state.message.id)}clearMessage(e){e!==this.state.message.id&&e!==this.state.message.campaign||this.setState({message:{}})}clearProvider(e){this.state.message.provider===e&&this.setState({message:{}})}onMessageFromParent({type:e,data:t}){switch(e){case"ClearMessages":t.forEach((e=>this.clearMessage(e)));break;case"ClearProviders":t.forEach((e=>this.clearProvider(e)));break;case"EnterSnippetsPreviewMode":this.props.dispatch({type:u.SNIPPETS_PREVIEW_MODE})}}requestMessage(e){O.sendMessage({type:"NEWTAB_MESSAGE_REQUEST",data:{endpoint:e}}).then((e=>this.setState(e)))}componentWillMount(){const e=O.getPreviewEndpoint();e&&"dark"===e.theme&&s.g.window.dispatchEvent(new CustomEvent("LightweightTheme:Set",{detail:{data:U}})),e&&"rtl"===e.dir&&(this.props.document.dir="rtl"),O.addListener(this.onMessageFromParent),this.requestMessage(e)}componentWillUnmount(){O.removeListener(this.onMessageFromParent)}componentDidUpdate(e,t){if(e.adminContent&&JSON.stringify(e.adminContent)!==JSON.stringify(this.props.adminContent)&&this.updateContent(),t.message.id!==this.state.message.id){const e=s.g.window.document.querySelector("main");e&&(this.state.message.id?e.classList.add("has-snippet"):e.classList.remove("has-snippet"))}}updateContent(){this.setState({...this.props.adminContent})}async getMonitorUrl({url:e,flowRequestParams:t={}}){const s=await this.fetchFlowParams(t),n=new URL(e);return["deviceId","flowId","flowBeginTime"].forEach((e=>{e in s&&n.searchParams.append(e,s[e])})),n.toString()}async onUserAction(e){if("ENABLE_FIREFOX_MONITOR"===e.type){const t=await this.getMonitorUrl(e.data.args);O.executeAction({type:"OPEN_URL",data:{args:t}})}else O.executeAction(e)}renderSnippets(){const{message:e}=this.state;if(!Z[e.template])return null;const t=Z[e.template],{content:s}=e;return P.createElement(D,{id:"NEWTAB_FOOTER_BAR",message:this.state.message,sendImpression:this.sendImpression,shouldSendImpressionOnUpdate:se,document:this.props.document},P.createElement(L._C,{bundles:N(s)},P.createElement(t,ee({},this.state.message,{UISurface:"NEWTAB_FOOTER_BAR",onBlock:this.onBlockSelected,onDismiss:this.onDismiss,onAction:this.onUserAction,sendClick:this.sendClick,sendUserActionTelemetry:this.sendUserActionTelemetry}))))}renderPreviewBanner(){return"preview"!==this.state.message.provider?null:P.createElement("div",{className:"snippets-preview-banner"},P.createElement("span",{className:"icon icon-small-spacer icon-info"}),P.createElement("span",null,"Preview Purposes Only"))}render(){const{message:e}=this.state;return e.id?te.includes(e.template)?P.createElement("div",{className:"below-search-snippet-wrapper"},this.renderSnippets()):B.createPortal(P.createElement(P.Fragment,null,this.renderPreviewBanner(),this.renderSnippets()),this.footerPortal):null}}ne.defaultProps={document:s.g.document};var oe=s(6458);class ie extends P.PureComponent{constructor(e){super(e),this._handleCancelBtn=this._handleCancelBtn.bind(this),this._handleConfirmBtn=this._handleConfirmBtn.bind(this)}_handleCancelBtn(){this.props.dispatch({type:u.DIALOG_CANCEL}),this.props.dispatch(g.UserEvent({event:u.DIALOG_CANCEL,source:this.props.data.eventSource}))}_handleConfirmBtn(){this.props.data.onConfirm.forEach(this.props.dispatch)}_renderModalMessage(){const e=this.props.data.body_string_id;return e?P.createElement("span",null,e.map((e=>P.createElement("p",{key:e,"data-l10n-id":e})))):null}render(){return this.props.visible?P.createElement("div",{className:"confirmation-dialog"},P.createElement("div",{className:"modal-overlay",onClick:this._handleCancelBtn,role:"presentation"}),P.createElement("div",{className:"modal"},P.createElement("section",{className:"modal-message"},this.props.data.icon&&P.createElement("span",{className:`icon icon-spacer icon-${this.props.data.icon}`}),this._renderModalMessage()),P.createElement("section",{className:"actions"},P.createElement("button",{onClick:this._handleCancelBtn,"data-l10n-id":this.props.data.cancel_button_string_id}),P.createElement("button",{className:"done",onClick:this._handleConfirmBtn,"data-l10n-id":this.props.data.confirm_button_string_id})))):null}}const re=(0,oe.$j)((e=>e.Dialog))(ie),ae=[{rotation:"0deg",offsetx:"20px",offsety:"8px",scale:"45%"},{rotation:"54deg",offsetx:"-26px",offsety:"62px",scale:"55%"},{rotation:"-30deg",offsetx:"78px",offsety:"30px",scale:"68%"},{rotation:"-22deg",offsetx:"0",offsety:"92px",scale:"60%"},{rotation:"-65deg",offsetx:"66px",offsety:"28px",scale:"60%"},{rotation:"22deg",offsetx:"-35px",offsety:"62px",scale:"52%"},{rotation:"-25deg",offsetx:"86px",offsety:"-15px",scale:"68%"}],ce="#0090ED #FF4F5F #2AC3A2 #FF7139 #A172FF #FFA437 #FF2A8A".split(" ");function le({keyCode:e,max:t}){return e?(e=>{let t=0;for(let s=0;s<e.length;s++)t+=e.charCodeAt(s);return t})(e)%t:Math.floor(Math.random()*t)}function pe({urlKey:e,titleKey:t}){const s=le({keyCode:e,max:ae.length}),n=le({keyCode:t,max:ce.length}),{rotation:o,offsetx:i,offsety:r,scale:a}=ae[s],c={"--placeholderBackgroundColor":ce[n],"--placeholderBackgroundRotation":o,"--placeholderBackgroundOffsetx":i,"--placeholderBackgroundOffsety":r,"--placeholderBackgroundScale":a};return P.createElement("div",{style:c,className:"placeholder-image"})}class de extends P.PureComponent{constructor(e){super(e),this.onOptimizedImageError=this.onOptimizedImageError.bind(this),this.onNonOptimizedImageError=this.onNonOptimizedImageError.bind(this),this.onLoad=this.onLoad.bind(this),this.state={isLoaded:!1,optimizedImageFailed:!1,useTransition:!1}}onIdleCallback(){this.state.isLoaded||this.setState({useTransition:!0})}reformatImageURL(e,t,s){return`https://img-getpocket.cdn.mozilla.net/${t}x${s}/filters:format(jpeg):quality(60):no_upscale():strip_exif()/${encodeURIComponent(e)}`}componentDidMount(){this.idleCallbackId=this.props.windowObj.requestIdleCallback(this.onIdleCallback.bind(this))}componentWillUnmount(){this.idleCallbackId&&this.props.windowObj.cancelIdleCallback(this.idleCallbackId)}render(){let e,t=`ds-image\n      ${this.props.extraClassNames?` ${this.props.extraClassNames}`:""}\n      ${this.state&&this.state.useTransition?" use-transition":""}\n      ${this.state&&this.state.isLoaded?" loaded":""}\n    `;if(this.state)if(this.props.optimize&&this.props.rawSource&&!this.state.optimizedImageFailed){let t=this.props.rawSource,s=[],n=[];for(let e of this.props.sizes){let{mediaMatcher:o,width:i,height:r}=e,a=`${o} ${i}px`;s.push(a);let c=`${this.reformatImageURL(t,i,r)} ${i}w`,l=`${this.reformatImageURL(t,2*i,2*r)} ${2*i}w`;n.push(c),n.push(l)}this.props.sizes.length&&s.push(`${this.props.sizes[this.props.sizes.length-1].width}px`),e=P.createElement("img",{loading:"lazy",alt:this.props.alt_text,crossOrigin:"anonymous",onLoad:this.onLoad,onError:this.onOptimizedImageError,sizes:s.join(","),src:t,srcSet:n.join(",")})}else this.props.source&&!this.state.nonOptimizedImageFailed?e=P.createElement("img",{loading:"lazy",alt:this.props.alt_text,crossOrigin:"anonymous",onLoad:this.onLoad,onError:this.onNonOptimizedImageError,src:this.props.source}):(t=`${t} loaded`,e=!this.props.isRecentSave||this.props.rawSource||this.props.source?P.createElement("div",{className:"broken-image"}):P.createElement(pe,{urlKey:this.props.url,titleKey:this.props.title}));return P.createElement("picture",{className:t},e)}onOptimizedImageError(){this.setState({optimizedImageFailed:!0})}onNonOptimizedImageError(){this.setState({nonOptimizedImageFailed:!0})}onLoad(){this.setState({isLoaded:!0})}}de.defaultProps={source:null,rawSource:null,extraClassNames:null,optimize:!0,alt_text:null,windowObj:window,sizes:[]};class he extends P.PureComponent{constructor(e){super(e),this.hideContext=this.hideContext.bind(this),this.onShow=this.onShow.bind(this),this.onClick=this.onClick.bind(this)}hideContext(){this.props.onUpdate(!1)}onShow(){this.props.onShow&&this.props.onShow()}componentDidMount(){this.onShow(),setTimeout((()=>{s.g.addEventListener("click",this.hideContext)}),0)}componentWillUnmount(){s.g.removeEventListener("click",this.hideContext)}onClick(e){e.stopPropagation()}render(){return P.createElement("span",{className:"context-menu"},P.createElement("ul",{role:"menu",onClick:this.onClick,onKeyDown:this.onClick,className:"context-menu-list"},this.props.options.map(((e,t)=>"separator"===e.type?P.createElement("li",{key:t,className:"separator",role:"separator"}):"empty"!==e.type&&P.createElement(ue,{key:t,option:e,hideContext:this.hideContext,keyboardAccess:this.props.keyboardAccess})))))}}class me extends P.PureComponent{constructor(e){super(e),this.onClick=this.onClick.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.focusFirst=this.focusFirst.bind(this)}onClick(e){this.props.hideContext(),this.props.option.onClick(e)}focusFirst(e){this.props.keyboardAccess&&e&&e.focus()}focusSibling(e,t){const s=e.parentNode,n="ArrowUp"===t?"previousSibling":"nextSibling";s[n]&&(s[n].firstElementChild?s[n].firstElementChild.focus():s[n][n].firstElementChild.focus())}onKeyDown(e){const{option:t}=this.props;switch(e.key){case"Tab":(e.shiftKey&&t.first||!e.shiftKey&&t.last)&&this.props.hideContext();break;case"ArrowUp":case"ArrowDown":e.preventDefault(),this.focusSibling(e.target,e.key);break;case"Enter":case" ":e.preventDefault(),this.props.hideContext(),t.onClick();break;case"Escape":this.props.hideContext()}}onKeyUp(e){" "===e.key&&e.preventDefault()}render(){const{option:e}=this.props;return P.createElement("li",{role:"presentation",className:"context-menu-item"},P.createElement("button",{className:e.disabled?"disabled":"",role:"menuitem",onClick:this.onClick,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,ref:e.first?this.focusFirst:null,"aria-haspopup":"newtab-menu-edit-topsites"===e.id?"dialog":null},P.createElement("span",{"data-l10n-id":e.string_id||e.id})))}}const ue=(0,oe.$j)((e=>({Prefs:e.Prefs})))(me),Ee={Separator:()=>({type:"separator"}),EmptyItem:()=>({type:"empty"}),ShowPrivacyInfo:e=>({id:"newtab-menu-show-privacy-info",icon:"info",action:{type:u.SHOW_PRIVACY_INFO},userEvent:"SHOW_PRIVACY_INFO"}),AboutSponsored:e=>({id:"newtab-menu-show-privacy-info",icon:"info",action:g.AlsoToMain({type:u.ABOUT_SPONSORED_TOP_SITES}),userEvent:"TOPSITE_SPONSOR_INFO"}),RemoveBookmark:e=>({id:"newtab-menu-remove-bookmark",icon:"bookmark-added",action:g.AlsoToMain({type:u.DELETE_BOOKMARK_BY_ID,data:e.bookmarkGuid}),userEvent:"BOOKMARK_DELETE"}),AddBookmark:e=>({id:"newtab-menu-bookmark",icon:"bookmark-hollow",action:g.AlsoToMain({type:u.BOOKMARK_URL,data:{url:e.url,title:e.title,type:e.type}}),userEvent:"BOOKMARK_ADD"}),OpenInNewWindow:e=>({id:"newtab-menu-open-new-window",icon:"new-window",action:g.AlsoToMain({type:u.OPEN_NEW_WINDOW,data:{referrer:e.referrer,typedBonus:e.typedBonus,url:e.url,sponsored_tile_id:e.sponsored_tile_id}}),userEvent:"OPEN_NEW_WINDOW"}),BlockUrl:(e,t,s)=>Ee.BlockUrls([e],t,s),BlockUrls:(e,t,s)=>({id:"newtab-menu-dismiss",icon:"dismiss",action:g.AlsoToMain({type:u.BLOCK_URL,data:e.map((e=>({url:e.original_url||e.open_url||e.url,pocket_id:e.pocket_id,isSponsoredTopSite:e.sponsored_position,...e.flight_id?{flight_id:e.flight_id}:{}})))}),impression:g.ImpressionStats({source:s,block:0,tiles:e.map(((e,s)=>({id:e.guid,pos:t+s,...e.shim&&e.shim.delete?{shim:e.shim.delete}:{}})))}),userEvent:"BLOCK"}),MoCoCNBlockUrl:(e,t,s)=>{let n=Ee.BlockUrl(e,t,s);return n.string_id="mococn-menu-dismiss",e.hasDSCollectionDismissConfig||(n.action=g.AlsoToMain({type:u.BLOCK_URL,data:{url:e.open_url||e.url,pocket_id:e.pocket_id,isSponsoredTopSite:e.sponsored_position,...e.flight_id?{flight_id:e.flight_id}:{}}})),n},WebExtDismiss:(e,t,s)=>({id:"menu_action_webext_dismiss",string_id:"newtab-menu-dismiss",icon:"dismiss",action:g.WebExtEvent(u.WEBEXT_DISMISS,{source:s,url:e.url,action_position:t})}),DeleteUrl:(e,t,s,n,o)=>({id:"newtab-menu-delete-history",icon:"delete",action:{type:u.DIALOG_OPEN,data:{onConfirm:[g.AlsoToMain({type:u.DELETE_HISTORY_URL,data:{url:e.url,pocket_id:e.pocket_id,forceBlock:e.bookmarkGuid}}),g.UserEvent(Object.assign({event:"DELETE",source:s,action_position:t},o))],eventSource:s,body_string_id:["newtab-confirm-delete-history-p1","newtab-confirm-delete-history-p2"],confirm_button_string_id:"newtab-topsites-delete-history-button",cancel_button_string_id:"newtab-topsites-cancel-button",icon:"modal-delete"}},userEvent:"DIALOG_OPEN"}),ShowFile:e=>({id:"newtab-menu-show-file",icon:"search",action:g.OnlyToMain({type:u.SHOW_DOWNLOAD_FILE,data:{url:e.url}})}),OpenFile:e=>({id:"newtab-menu-open-file",icon:"open-file",action:g.OnlyToMain({type:u.OPEN_DOWNLOAD_FILE,data:{url:e.url}})}),CopyDownloadLink:e=>({id:"newtab-menu-copy-download-link",icon:"copy",action:g.OnlyToMain({type:u.COPY_DOWNLOAD_LINK,data:{url:e.url}})}),GoToDownloadPage:e=>({id:"newtab-menu-go-to-download-page",icon:"download",action:g.OnlyToMain({type:u.OPEN_LINK,data:{url:e.referrer}}),disabled:!e.referrer}),RemoveDownload:e=>({id:"newtab-menu-remove-download",icon:"delete",action:g.OnlyToMain({type:u.REMOVE_DOWNLOAD_FILE,data:{url:e.url}})}),PinTopSite:(e,t)=>({id:"newtab-menu-pin",icon:"pin",action:g.AlsoToMain({type:u.TOP_SITES_PIN,data:{site:e,index:t}}),userEvent:"PIN"}),UnpinTopSite:e=>({id:"newtab-menu-unpin",icon:"unpin",action:g.AlsoToMain({type:u.TOP_SITES_UNPIN,data:{site:{url:e.url}}}),userEvent:"UNPIN"}),MoCoCNUnpinTopSite:e=>{let t=Ee.UnpinTopSite(e);return t.id="mococn-menu-unpin",t.icon="delete",t},SaveToPocket:(e,t,s="CARDGRID")=>({id:"newtab-menu-save-to-pocket",icon:"pocket-save",action:g.AlsoToMain({type:u.SAVE_TO_POCKET,data:{site:{url:e.url,title:e.title}}}),impression:g.ImpressionStats({source:s,pocket:0,tiles:[{id:e.guid,pos:t,...e.shim&&e.shim.save?{shim:e.shim.save}:{}}]}),userEvent:"SAVE_TO_POCKET"}),DeleteFromPocket:e=>({id:"newtab-menu-delete-pocket",icon:"pocket-delete",action:g.AlsoToMain({type:u.DELETE_FROM_POCKET,data:{pocket_id:e.pocket_id}}),userEvent:"DELETE_FROM_POCKET"}),ArchiveFromPocket:e=>({id:"newtab-menu-archive-pocket",icon:"pocket-archive",action:g.AlsoToMain({type:u.ARCHIVE_FROM_POCKET,data:{pocket_id:e.pocket_id}}),userEvent:"ARCHIVE_FROM_POCKET"}),EditTopSite:(e,t)=>({id:"newtab-menu-edit-topsites",icon:"edit",action:{type:u.TOP_SITES_EDIT,data:{index:t}}}),CheckBookmark:e=>e.bookmarkGuid?Ee.RemoveBookmark(e):Ee.AddBookmark(e),CheckPinTopSite:(e,t)=>e.isPinned?Ee.UnpinTopSite(e):Ee.PinTopSite(e,t),CheckSavedToPocket:(e,t,s)=>e.pocket_id?Ee.DeleteFromPocket(e):Ee.SaveToPocket(e,t,s),CheckBookmarkOrArchive:e=>e.pocket_id?Ee.ArchiveFromPocket(e):Ee.CheckBookmark(e),CheckArchiveFromPocket:e=>e.pocket_id?Ee.ArchiveFromPocket(e):Ee.EmptyItem(),CheckDeleteFromPocket:e=>e.pocket_id?Ee.DeleteFromPocket(e):Ee.EmptyItem(),OpenInPrivateWindow:(e,t,s,n)=>n?(e=>({id:"newtab-menu-open-new-private-window",icon:"new-window-private",action:g.OnlyToMain({type:u.OPEN_PRIVATE_WINDOW,data:{url:e.url,referrer:e.referrer}}),userEvent:"OPEN_PRIVATE_WINDOW"}))(e):Ee.EmptyItem()},Se=["CheckPinTopSite","EditTopSite","Separator","OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl"];class _e extends P.PureComponent{getOptions(){const{props:e}=this,{site:t,hasDSCollectionDismissConfig:s,index:n,source:o,isPrivateBrowsingEnabled:i,siteInfo:r,platform:a,userEvent:c=g.UserEvent}=e;Object.assign(t,{hasDSCollectionDismissConfig:s});const l=(!t.isDefault||t.searchTopSite||t.sponsored_position?e.options:Se).map((e=>Ee[e](t,n,o,i,r,a))).map((s=>{const{action:i,impression:a,id:l,type:p,userEvent:d}=s;return!p&&l&&(s.onClick=(s={})=>{const{ctrlKey:l,metaKey:p,shiftKey:h,button:m}=s;if((l||p||h||1===m)&&(i.data=Object.assign({event:{ctrlKey:l,metaKey:p,shiftKey:h,button:m}},i.data)),e.dispatch(i),d){const s=Object.assign({event:d,source:o,action_position:n,value:{card_type:t.flight_id?"spoc":"organic"}},r);e.dispatch(c(s))}a&&e.shouldSendImpressionStats&&e.dispatch(a)}),s}));return l[0].first=!0,l[l.length-1].last=!0,l}render(){return P.createElement(he,{onUpdate:this.props.onUpdate,onShow:this.props.onShow,options:this.getOptions(),keyboardAccess:this.props.keyboardAccess})}}const ge=(0,oe.$j)((e=>({hasDSCollectionDismissConfig:e.Prefs.values.hasOwnProperty("discoverystream.isCollectionDismissible"),isPrivateBrowsingEnabled:e.Prefs.values.isPrivateBrowsingEnabled,platform:e.Prefs.values.platform})))(_e);class ve extends P.PureComponent{constructor(e){super(e),this.state={showContextMenu:!1,contextMenuKeyboard:!1},this.onClick=this.onClick.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onUpdate=this.onUpdate.bind(this)}openContextMenu(e,t){this.props.onUpdate&&this.props.onUpdate(!0),this.setState({showContextMenu:!0,contextMenuKeyboard:e})}onClick(e){e.preventDefault(),this.openContextMenu(!1,e)}onKeyDown(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.openContextMenu(!0,e))}onUpdate(e){this.props.onUpdate&&this.props.onUpdate(e),this.setState({showContextMenu:e})}render(){const{tooltipArgs:e,tooltip:t,children:s,refFunction:n}=this.props,{showContextMenu:o,contextMenuKeyboard:i}=this.state;return P.createElement(P.Fragment,null,P.createElement("button",{"aria-haspopup":"true","data-l10n-id":t,"data-l10n-args":e?JSON.stringify(e):null,className:"context-menu-button icon",onKeyDown:this.onKeyDown,onClick:this.onClick,ref:n}),o?P.cloneElement(s,{keyboardAccess:i,onUpdate:this.onUpdate}):null)}}class fe extends P.PureComponent{render(){const{index:e,dispatch:t}=this.props;let s=[],n=["OpenInNewWindow","OpenInPrivateWindow"];this.props.isRecentSave||(this.props.pocket_button_enabled&&(s=this.props.saveToPocketCard?["CheckDeleteFromPocket"]:["CheckSavedToPocket"]),n=["CheckBookmark","CheckArchiveFromPocket",...s,"Separator","OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl",...this.props.showPrivacyInfo?["ShowPrivacyInfo"]:[]]);const o=this.props.type||"DISCOVERY_STREAM",i=this.props.title||this.props.source;return P.createElement("div",{className:"context-menu-position-container"},P.createElement(ve,{tooltip:"newtab-menu-content-tooltip",tooltipArgs:{title:i},onUpdate:this.props.onMenuUpdate},P.createElement(ge,{dispatch:t,index:e,source:o.toUpperCase(),onShow:this.props.onMenuShow,options:M?["MoCoCNBlockUrl","Separator","OpenInNewWindow","OpenInPrivateWindow"]:n,shouldSendImpressionStats:!0,userEvent:g.DiscoveryStreamUserEvent,site:{referrer:M?"":"https://getpocket.com/recommendations",title:this.props.title,type:this.props.type,url:this.props.url,guid:this.props.id,pocket_id:this.props.pocket_id,shim:this.props.shim,bookmarkGuid:this.props.bookmarkGuid,flight_id:this.props.flightId}})))}}const be="TOP_SITES",Ce=["CheckPinTopSite","EditTopSite","Separator","OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl","DeleteUrl"],ye=["OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl","ShowPrivacyInfo"],ke=["OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl","AboutSponsored"],Oe=["CheckPinTopSite","Separator","BlockUrl"],Te=["MoCoCNUnpinTopSite","EditTopSite","Separator","OpenInNewWindow","OpenInPrivateWindow"],we="visible",Ie="visibilitychange";class Ne extends P.PureComponent{_needsImpressionStats(e){if(!this.impressionCardGuids||this.impressionCardGuids.length!==e.length)return!0;for(let t=0;t<e.length;t++)if(e[t].id!==this.impressionCardGuids[t])return!0;return!1}_dispatchImpressionStats(){const{props:e}=this,t=e.rows;if(this.props.flightId&&(this.props.dispatch(g.OnlyToMain({type:u.DISCOVERY_STREAM_SPOC_IMPRESSION,data:{flightId:this.props.flightId}})),this.props.source===be))for(const e of t)this.props.dispatch(g.OnlyToMain({type:u.TOP_SITES_SPONSORED_IMPRESSION_STATS,data:{type:"impression",tile_id:e.id,source:"newtab",advertiser:e.advertiser,position:e.pos+1}}));this._needsImpressionStats(t)&&(e.dispatch(g.DiscoveryStreamImpressionStats({source:e.source.toUpperCase(),window_inner_width:window.innerWidth,window_inner_height:window.innerHeight,tiles:t.map((e=>({id:e.id,pos:e.pos,type:this.props.flightId?"spoc":"organic",...e.shim?{shim:e.shim}:{}})))})),this.impressionCardGuids=t.map((e=>e.id)))}_needsLoadedContent(e){if(!this.loadedContentGuids||this.loadedContentGuids.length!==e.length)return!0;for(let t=0;t<e.length;t++)if(e[t].id!==this.loadedContentGuids[t])return!0;return!1}_dispatchLoadedContent(){const{props:e}=this,t=e.rows;this._needsLoadedContent(t)&&(e.dispatch(g.DiscoveryStreamLoadedContent({source:e.source.toUpperCase(),tiles:t.map((e=>({id:e.id,pos:e.pos})))})),this.loadedContentGuids=t.map((e=>e.id)))}setImpressionObserverOrAddListener(){const{props:e}=this;e.dispatch&&(e.document.visibilityState===we?(this._dispatchLoadedContent(),this.setImpressionObserver()):(this._onVisibilityChange&&e.document.removeEventListener(Ie,this._onVisibilityChange),this._onVisibilityChange=()=>{e.document.visibilityState===we&&(this._dispatchLoadedContent(),this.setImpressionObserver(),e.document.removeEventListener(Ie,this._onVisibilityChange))},e.document.addEventListener(Ie,this._onVisibilityChange)))}setImpressionObserver(){const{props:e}=this;if(!e.rows.length)return;this._handleIntersect=e=>{e.some((e=>e.isIntersecting&&e.intersectionRatio>=.5))&&(this._dispatchImpressionStats(),this.impressionObserver.unobserve(this.refs.impression))};this.impressionObserver=new e.IntersectionObserver(this._handleIntersect,{threshold:.5}),this.impressionObserver.observe(this.refs.impression)}componentDidMount(){this.props.rows.length&&this.setImpressionObserverOrAddListener()}componentWillUnmount(){this._handleIntersect&&this.impressionObserver&&this.impressionObserver.unobserve(this.refs.impression),this._onVisibilityChange&&this.props.document.removeEventListener(Ie,this._onVisibilityChange)}render(){return P.createElement("div",{ref:"impression",className:"impression-observer"},this.props.children)}}Ne.defaultProps={IntersectionObserver:s.g.IntersectionObserver,document:s.g.document,rows:[],source:""};class Pe extends P.PureComponent{constructor(e){super(e),this.onClick=this.onClick.bind(this)}onClick(e){if(this.props.dispatch){e.preventDefault();const{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i}=e;this.props.dispatch(g.OnlyToMain({type:u.OPEN_LINK,data:{event:{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i},referrer:M?"":"https://getpocket.com/recommendations",url:e.currentTarget.href}}))}this.props.onLinkClick&&this.props.onLinkClick(e)}safeURI(e){let t=null;try{t=new URL(e).protocol}catch(e){return""}return["http:","https:"].includes(t)?e:(console.warn(`${e} is not allowed for anchor targets.`),"")}render(){const{url:e,className:t}=this.props;return P.createElement("a",{href:this.safeURI(e),className:t,onClick:this.onClick},this.props.children)}}const Re={history:{fluentID:"newtab-label-visited",icon:"history-item"},removedBookmark:{fluentID:"newtab-label-removed-bookmark",icon:"bookmark-removed"},bookmark:{fluentID:"newtab-label-bookmarked",icon:"bookmark-added"},trending:{fluentID:"newtab-label-recommended",icon:"trending"},pocket:{fluentID:"newtab-label-saved",icon:"pocket"},download:{fluentID:"newtab-label-download",icon:"download"}};var Ae=s(666),De=s(8983);class Le extends P.PureComponent{render(){const{children:e,message:t}=this.props,s=e?P.Children.only(e):P.createElement("span",null);let n,o=t;if("object"==typeof t){const e=t.args||t.values;n={"data-l10n-args":e&&JSON.stringify(e),"data-l10n-id":t.id||t.string_id},o=s.props.children}return P.cloneElement(s,n,o)}}const Me=e=>{const{context:t,context_type:s}=e,{icon:n,fluentID:o}=Re[s]||{};return!t&&s?P.createElement(Ae.Z,{component:null},P.createElement(De.Z,{key:o,timeout:3e3,classNames:"story-animate"},P.createElement(xe,{icon:n,fluentID:o}))):null},xe=({icon:e,fluentID:t})=>P.createElement("div",{className:"status-message"},P.createElement("span",{"aria-haspopup":"true",className:`story-badge-icon icon icon-${e}`}),P.createElement("div",{className:"story-context-label","data-l10n-id":t})),Ue=({sponsored_by_override:e,sponsor:t,context:s,newSponsoredLabel:n})=>{const o=`story-sponsored-label ${n||""} clamp`;return e?P.createElement("p",{className:o},e):""===e?null:t?P.createElement("p",{className:o},P.createElement(Le,{message:{id:"newtab-label-sponsored-by",values:{sponsor:t}}})):s?P.createElement("p",{className:o},s):null};class Be extends P.PureComponent{render(){const{context:e,context_type:t,sponsor:s,sponsored_by_override:n}=this.props,o=Ue({sponsored_by_override:n,sponsor:s,context:e}),i=Me({context:e,context_type:t});return o||i?P.createElement("div",{className:"story-footer"},o,i):null}}const Fe=e=>{const{context:t,context_type:s,saveToPocketCard:n}=e,o=Me({context:t,context_type:s});return!o||n&&"pocket"===s?null:P.createElement("div",{className:"story-footer"},o)},Ke=({source:e,timeToRead:t,newSponsoredLabel:s,context:n,sponsor:o,sponsored_by_override:i})=>s&&(i||o||n)?P.createElement(Ue,{context:n,sponsor:o,sponsored_by_override:i,newSponsoredLabel:"new-sponsored-label"}):t?P.createElement("p",{className:"source clamp time-to-read"},P.createElement(Le,{message:{id:"newtab-label-source-read-time",values:{source:e,timeToRead:t}}})):P.createElement("p",{className:"source clamp"},e),Ve=({source:e,title:t,excerpt:s,timeToRead:n,newSponsoredLabel:o,context:i,context_type:r,sponsor:a,sponsored_by_override:c,saveToPocketCard:l,isRecentSave:p})=>P.createElement("div",{className:"meta"},P.createElement("div",{className:"info-wrap"},P.createElement(Ke,{source:e,timeToRead:n,newSponsoredLabel:o,context:i,sponsor:a,sponsored_by_override:c}),P.createElement("header",{title:t,className:"title clamp"},t),s&&P.createElement("p",{className:"excerpt clamp"},s)),!o&&P.createElement(Be,{context_type:r,context:i,sponsor:a,sponsored_by_override:c}),o&&P.createElement(Fe,{context_type:r,context:null,saveToPocketCard:l}));class He extends P.PureComponent{constructor(e){super(e),this.onLinkClick=this.onLinkClick.bind(this),this.onSaveClick=this.onSaveClick.bind(this),this.onMenuUpdate=this.onMenuUpdate.bind(this),this.onMenuShow=this.onMenuShow.bind(this),this.setContextMenuButtonHostRef=e=>{this.contextMenuButtonHostElement=e},this.setPlaceholderRef=e=>{this.placeholderElement=e},this.state={isSeen:!1},e.App.isForStartupCache&&(this.state.isSeen=!0),this.dsImageSizes=[{mediaMatcher:"(min-width: 1122px)",width:296,height:148},{mediaMatcher:"(min-width: 866px)",width:218,height:109},{mediaMatcher:"(max-width: 610px)",width:202,height:101}]}onLinkClick(e){this.props.dispatch&&(this.props.dispatch(g.DiscoveryStreamUserEvent({event:"CLICK",source:this.props.type.toUpperCase(),action_position:this.props.pos,value:{card_type:this.props.flightId?"spoc":"organic"}})),this.props.dispatch(g.ImpressionStats({source:this.props.type.toUpperCase(),click:0,window_inner_width:this.props.windowObj.innerWidth,window_inner_height:this.props.windowObj.innerHeight,tiles:[{id:this.props.id,pos:this.props.pos,...this.props.shim&&this.props.shim.click?{shim:this.props.shim.click}:{},type:this.props.flightId?"spoc":"organic"}]})))}onSaveClick(e){this.props.dispatch&&(this.props.dispatch(g.AlsoToMain({type:u.SAVE_TO_POCKET,data:{site:{url:this.props.url,title:this.props.title}}})),this.props.dispatch(g.DiscoveryStreamUserEvent({event:"SAVE_TO_POCKET",source:"CARDGRID_HOVER",action_position:this.props.pos,value:{card_type:this.props.flightId?"spoc":"organic"}})),this.props.dispatch(g.ImpressionStats({source:"CARDGRID_HOVER",pocket:0,tiles:[{id:this.props.id,pos:this.props.pos,...this.props.shim&&this.props.shim.save?{shim:this.props.shim.save}:{}}]})))}onMenuUpdate(e){if(!e){const e=this.contextMenuButtonHostElement;e&&e.classList.remove("active","last-item")}}async onMenuShow(){const e=this.contextMenuButtonHostElement;e&&(await this.props.windowObj.document.l10n.translateFragment(e),this.props.windowObj.scrollMaxX>0&&e.classList.add("last-item"),e.classList.add("active"))}onSeen(e){this.state&&e.find((e=>e.isIntersecting))&&(this.placeholderElement&&this.observer.unobserve(this.placeholderElement),this.setState({isSeen:!0}))}onIdleCallback(){this.state.isSeen||(this.observer&&this.placeholderElement&&this.observer.unobserve(this.placeholderElement),this.setState({isSeen:!0}))}componentDidMount(){this.idleCallbackId=this.props.windowObj.requestIdleCallback(this.onIdleCallback.bind(this)),this.placeholderElement&&(this.observer=new IntersectionObserver(this.onSeen.bind(this)),this.observer.observe(this.placeholderElement))}componentWillUnmount(){this.observer&&this.placeholderElement&&this.observer.unobserve(this.placeholderElement),this.idleCallbackId&&this.props.windowObj.cancelIdleCallback(this.idleCallbackId)}render(){if(this.props.placeholder||!this.state.isSeen)return P.createElement("div",{className:"ds-card placeholder",ref:this.setPlaceholderRef});const{isRecentSave:e,DiscoveryStream:t,saveToPocketCard:s}=this.props,{pocketButtonEnabled:n,hideDescriptions:o,compactImages:i,imageGradient:r,newSponsoredLabel:a,titleLines:c=3,descLines:l=3,readTime:p}=t,d=o?"":this.props.excerpt;let h;var m;p&&(h=this.props.time_to_read||!!(m=this.props.word_count)&&Math.ceil(parseInt(m,10)/220));const u=i?"ds-card-compact-image":"",E=r?"ds-card-image-gradient":"",S=`ds-card-title-lines-${c}`,_=`ds-card-desc-lines-${l}`;return P.createElement("div",{className:`ds-card ${u} ${E} ${S} ${_}`,ref:this.setContextMenuButtonHostRef},P.createElement(Pe,{className:"ds-card-link",dispatch:this.props.dispatch,onLinkClick:this.props.placeholder?void 0:this.onLinkClick,url:this.props.url},P.createElement("div",{className:"img-wrapper"},P.createElement(de,{extraClassNames:"img",source:this.props.image_src,rawSource:this.props.raw_image_src,sizes:this.dsImageSizes,url:this.props.url,title:this.props.title,isRecentSave:e})),P.createElement(Ve,{source:this.props.source,title:this.props.title,excerpt:d,newSponsoredLabel:a,timeToRead:h,context:this.props.context,context_type:this.props.context_type,sponsor:this.props.sponsor,sponsored_by_override:this.props.sponsored_by_override,saveToPocketCard:s}),P.createElement(Ne,{flightId:this.props.flightId,rows:[{id:this.props.id,pos:this.props.pos,...this.props.shim&&this.props.shim.impression?{shim:this.props.shim.impression}:{}}],dispatch:this.props.dispatch,source:this.props.type})),s&&P.createElement("div",{className:"card-stp-button-hover-background"},P.createElement("div",{className:"card-stp-button-position-wrapper"},!this.props.flightId&&(()=>P.createElement("button",{className:"card-stp-button",onClick:this.onSaveClick},"pocket"===this.props.context_type?P.createElement(P.Fragment,null,P.createElement("span",{className:"story-badge-icon icon icon-pocket"}),P.createElement("span",{"data-l10n-id":"newtab-pocket-saved"})):P.createElement(P.Fragment,null,P.createElement("span",{className:"story-badge-icon icon icon-pocket-save"}),P.createElement("span",{"data-l10n-id":"newtab-pocket-save"}))))(),P.createElement(fe,{id:this.props.id,index:this.props.pos,dispatch:this.props.dispatch,url:this.props.url,title:this.props.title,source:this.props.source,type:this.props.type,pocket_id:this.props.pocket_id,shim:this.props.shim,bookmarkGuid:this.props.bookmarkGuid,flightId:this.props.is_collection?void 0:this.props.flightId,showPrivacyInfo:!!this.props.flightId,onMenuUpdate:this.onMenuUpdate,onMenuShow:this.onMenuShow,saveToPocketCard:s,pocket_button_enabled:n,isRecentSave:e}))),!s&&P.createElement(fe,{id:this.props.id,index:this.props.pos,dispatch:this.props.dispatch,url:this.props.url,title:this.props.title,source:this.props.source,type:this.props.type,pocket_id:this.props.pocket_id,shim:this.props.shim,bookmarkGuid:this.props.bookmarkGuid,flightId:this.props.is_collection?void 0:this.props.flightId,showPrivacyInfo:!!this.props.flightId,hostRef:this.contextMenuButtonHostRef,onMenuUpdate:this.onMenuUpdate,onMenuShow:this.onMenuShow,pocket_button_enabled:n,isRecentSave:e}))}}He.defaultProps={windowObj:window};const We=(0,oe.$j)((e=>({App:e.App,DiscoveryStream:e.DiscoveryStream})))(He),je=e=>P.createElement(We,{placeholder:!0});class $e extends P.PureComponent{constructor(e){super(e),this.onReset=this.onReset.bind(this),this.state={}}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout)}onReset(){if(this.props.dispatch&&this.props.feed){const{feed:e}=this.props,{url:t}=e;this.props.dispatch({type:u.DISCOVERY_STREAM_FEED_UPDATE,data:{feed:{...e,data:{...e.data,status:"waiting"}},url:t}}),this.setState({waiting:!0}),this.timeout=setTimeout((()=>{this.timeout=null,this.setState({waiting:!1})}),300),this.props.dispatch(g.OnlyToMain({type:u.DISCOVERY_STREAM_RETRY_FEED,data:{feed:e}}))}}renderButton(){return"waiting"===this.props.status||this.state.waiting?P.createElement("button",{className:"try-again-button waiting","data-l10n-id":"newtab-discovery-empty-section-topstories-loading"}):P.createElement("button",{className:"try-again-button",onClick:this.onReset,"data-l10n-id":"newtab-discovery-empty-section-topstories-try-again-button"})}renderState(){return"waiting"===this.props.status||"failed"===this.props.status?P.createElement(P.Fragment,null,P.createElement("h2",{"data-l10n-id":"newtab-discovery-empty-section-topstories-timed-out"}),this.renderButton()):P.createElement(P.Fragment,null,P.createElement("h2",{"data-l10n-id":"newtab-discovery-empty-section-topstories-header"}),P.createElement("p",{"data-l10n-id":"newtab-discovery-empty-section-topstories-content"}))}render(){return P.createElement("div",{className:"section-empty-state"},P.createElement("div",{className:"empty-state-message"},this.renderState()))}}function Ge(e){const{id:t,source:s,position:n,DiscoveryStream:o,dispatch:i}=e,{utmCampaign:r,utmContent:a,utmSource:c}=o.experimentData;let l=`?utm_source=${c}`;r&&a&&(l+=`&utm_content=${a}&utm_campaign=${r}`);const p=[{label:"Technology",name:"technology"},{label:"Science",name:"science"},{label:"Self-Improvement",name:"self-improvement"},{label:"Travel",name:"travel"},{label:"Career",name:"career"},{label:"Entertainment",name:"entertainment"},{label:"Food",name:"food"},{label:"Health",name:"health"},{label:"Must-Reads",name:"must-reads",url:`https://getpocket.com/collections${l}`}];function d(o,r){i&&(i(g.DiscoveryStreamUserEvent({event:"CLICK",source:s,action_position:n,value:{card_type:"topics_widget",topic:o,...r||0===r?{position_in_card:r}:{}}})),i(g.ImpressionStats({source:s,click:0,window_inner_width:e.windowObj.innerWidth,window_inner_height:e.windowObj.innerHeight,tiles:[{id:t,pos:n}]})))}return P.createElement("div",{className:"ds-topics-widget"},P.createElement("header",{className:"ds-topics-widget-header"},"Popular Topics"),P.createElement("hr",null),P.createElement("div",{className:"ds-topics-widget-list-container"},P.createElement("ul",null,p.map((function(e,t){return P.createElement("li",{key:e.name,className:e.overflow?"ds-topics-widget-list-overflow-item":""},P.createElement(Pe,{url:e.url||`https://getpocket.com/explore/${e.name}${l}`,dispatch:i,onLinkClick:()=>d(e.name,t)},e.label))})))),P.createElement(Pe,{className:"ds-topics-widget-button button primary",url:`https://getpocket.com/${l}`,dispatch:i,onLinkClick:()=>d("more-topics")},"More Topics"),P.createElement(Ne,{dispatch:i,rows:[{id:t,pos:n}],source:s}))}Ge.defaultProps={windowObj:window};const Ye=(0,oe.$j)((e=>({DiscoveryStream:e.DiscoveryStream})))(Ge);function ze({children:e}){return P.createElement("div",{className:"section-top-bar ds-sub-header"},P.createElement("h3",{className:"section-title-container"},e))}function qe({children:e,windowObj:t=window,onIntersecting:s}){const n=(0,P.useRef)(null);return(0,P.useEffect)((()=>{let e;return!e&&s&&n.current&&(e=new t.IntersectionObserver((t=>{t.find((e=>e.isIntersecting))&&(e&&n.current&&e.unobserve(n.current),s())})),e.observe(n.current)),()=>{var t;return null===(t=e)||void 0===t?void 0:t.disconnect()}}),[t,s]),P.createElement("div",{ref:n},e)}function Qe({gridClassName:e="",dispatch:t,windowObj:s=window,items:n=3,source:o="CARDGRID_RECENT_SAVES"}){const{recentSavesData:i,isUserLoggedIn:r,experimentData:{utmCampaign:a,utmContent:c,utmSource:l}}=(0,oe.v9)((e=>e.DiscoveryStream)),[p,d]=(0,P.useState)(!1),h=(0,P.useCallback)((()=>d(!0)),[]);if((0,P.useEffect)((()=>{p&&t(g.AlsoToMain({type:u.DISCOVERY_STREAM_POCKET_STATE_INIT}))}),[p,t]),!p)return P.createElement(qe,{windowObj:s,onIntersecting:h});if(p&&!r)return null;let m=`?utm_source=${l}`;function E(e,s){const n=new URL(e.url),i=new URLSearchParams(m);null!=e&&e.id&&!n.href.match(/getpocket\.com\/read/)&&(n.href=`https://getpocket.com/read/${e.id}`);for(let[e,t]of i.entries())n.searchParams.set(e,t);return P.createElement(We,{key:`dscard-${(null==e?void 0:e.id)||s}`,id:e.id,pos:s,type:o,image_src:e.image_src,raw_image_src:e.raw_image_src,word_count:e.word_count,time_to_read:e.time_to_read,title:e.title,excerpt:e.excerpt,url:n.href,source:e.domain,isRecentSave:!0,dispatch:t})}a&&c&&(m+=`&utm_content=${c}&utm_campaign=${a}`);const S=[];for(let e=0;e<n;e++){const t=i[e];var _;t?S.push(E({id:t.id,image_src:t.top_image_url,raw_image_src:t.top_image_url,word_count:t.word_count,time_to_read:t.time_to_read,title:t.resolved_title||t.given_title,url:t.resolved_url||t.given_url,domain:null===(_=t.domain_metadata)||void 0===_?void 0:_.name,excerpt:t.excerpt},e)):S.push(P.createElement(je,{key:`dscard-${e}`}))}return P.createElement(P.Fragment,null,P.createElement(ze,null,P.createElement("span",{className:"section-title"},P.createElement(Le,{message:"Recently Saved to your List"})),P.createElement(Pe,{onLinkClick:function(){t(g.DiscoveryStreamUserEvent({event:"CLICK",source:`${o}_VIEW_LIST`}))},className:"section-sub-link",url:`https://getpocket.com/a${m}`},P.createElement(Le,{message:"View My List"}))),P.createElement("div",{className:`ds-card-grid-recent-saves ${e}`},S))}class Je extends P.PureComponent{renderCards(){var e,t,s,n;const o=this.props.Prefs.values,{items:i,hybridLayout:r,hideCardBackground:a,fourCardLayout:c,compactGrid:l,essentialReadsHeader:p,editorsPicksHeader:d,widgets:h,recentSavesEnabled:m,hideDescriptions:u,DiscoveryStream:E}=this.props,{saveToPocketCard:S}=E,_=o.showRecentSaves&&m,g=this.props.data.recommendations.slice(0,i),v=[];let f=[],b=[];for(let e=0;e<i;e++){const t=g[e];M&&t&&t.context&&(t.domain=t.context,t.context=""),v.push(!t||t.placeholder?P.createElement(je,{key:`dscard-${e}`}):P.createElement(We,{key:`dscard-${t.id}`,pos:t.pos,flightId:t.flight_id,image_src:t.image_src,raw_image_src:t.raw_image_src,word_count:t.word_count,time_to_read:t.time_to_read,title:t.title,excerpt:t.excerpt,url:t.url,id:t.id,shim:t.shim,type:this.props.type,context:t.context,sponsor:t.sponsor,sponsored_by_override:t.sponsored_by_override,dispatch:this.props.dispatch,source:t.domain,pocket_id:t.pocket_id,context_type:t.context_type,bookmarkGuid:t.bookmarkGuid,is_collection:this.props.is_collection,saveToPocketCard:S}))}if(null!=h&&null!==(e=h.positions)&&void 0!==e&&e.length&&null!=h&&null!==(t=h.data)&&void 0!==t&&t.length){let e=0;const t="CARDGRID_WIDGET";for(const s of h.data){let n=null;const o=h.positions[e];if(!o)break;"TopicsWidget"===(null==s?void 0:s.type)&&(n=P.createElement(Ye,{position:o.index,dispatch:this.props.dispatch,source:t,id:1})),n&&(e++,v.splice(o.index,1,n))}}let C="";if(_||p&&d){let e=6;c&&(e=8),C="More Recommendations",f=[...v.splice(0,e)],p&&d&&(b=[...v.splice(0,v.length)])}const y=`ds-card-grid ds-card-grid-border ${r?"ds-card-grid-hybrid-layout":""} ${a?"ds-card-grid-hide-background":""} ${c?"ds-card-grid-four-card-variant":""} ${u?"":"ds-card-grid-include-descriptions"} ${l?"ds-card-grid-compact":""}`;return P.createElement(P.Fragment,null,(null===(s=f)||void 0===s?void 0:s.length)>0&&P.createElement("div",{className:y},f),_&&P.createElement(Qe,{gridClassName:y,dispatch:this.props.dispatch}),(null===(n=b)||void 0===n?void 0:n.length)>0&&P.createElement(P.Fragment,null,P.createElement(ze,null,P.createElement("span",{className:"section-title"},P.createElement(Le,{message:"Editor’s Picks"}))),P.createElement("div",{className:y},b)),(null==v?void 0:v.length)>0&&P.createElement(P.Fragment,null,C&&P.createElement(ze,null,P.createElement("span",{className:"section-title"},P.createElement(Le,{message:C}))),P.createElement("div",{className:y},v)))}render(){const{data:e}=this.props;if(!e)return null;const t=0===e.recommendations.length;return P.createElement("div",null,this.props.title&&P.createElement("div",{className:"ds-header"},P.createElement("div",{className:"title"},this.props.title),this.props.context&&P.createElement(Le,{message:this.props.context},P.createElement("div",{className:"ds-context"}))),t?P.createElement("div",{className:"ds-card-grid empty"},P.createElement($e,{status:e.status,dispatch:this.props.dispatch,feed:this.props.feed})):this.renderCards())}}Je.defaultProps={items:4};const Xe=(0,oe.$j)((e=>({Prefs:e.Prefs,DiscoveryStream:e.DiscoveryStream})))(Je);class Ze extends P.PureComponent{constructor(e){super(e),this.onDismissClick=this.onDismissClick.bind(this),this.onHover=this.onHover.bind(this),this.offHover=this.offHover.bind(this),this.state={hovering:!1}}onDismissClick(){this.props.onDismissClick&&this.props.onDismissClick()}onHover(){this.setState({hovering:!0})}offHover(){this.setState({hovering:!1})}render(){let e=`ds-dismiss\n      ${this.state.hovering?" hovering":""}\n      ${this.props.extraClasses?` ${this.props.extraClasses}`:""}`;return P.createElement("div",{className:e},this.props.children,P.createElement("button",{className:"ds-dismiss-button","data-l10n-id":"newtab-dismiss-button-tooltip",onHover:this.onHover,onClick:this.onDismissClick,onMouseEnter:this.onHover,onMouseLeave:this.offHover},P.createElement("span",{className:"icon icon-dismiss"})))}}class et extends P.PureComponent{constructor(e){super(e),this.onDismissClick=this.onDismissClick.bind(this),this.state={dismissed:!1}}onDismissClick(){const{data:e}=this.props;if(this.props.dispatch&&e&&e.spocs&&e.spocs.length){this.setState({dismissed:!0});const t=0,s=this.props.type.toUpperCase(),n=e.spocs.map((e=>({url:e.url,guid:e.id,shim:e.shim,flight_id:e.flightId}))),o=Ee.BlockUrls(n,t,s),{action:i,impression:r,userEvent:a}=o;this.props.dispatch(i),this.props.dispatch(g.DiscoveryStreamUserEvent({event:a,source:s,action_position:t})),r&&this.props.dispatch(r)}}render(){const{data:e,dismissible:t,pocket_button_enabled:s}=this.props;if(this.state.dismissed||!e||!e.spocs||!e.spocs[0]||e.spocs.length<3)return null;const{spocs:n,placement:o,feed:i}=this.props,{title:r,context:a,sponsored_by_override:c,sponsor:l}=n.data[o.name]||{};if(!r)return null;let p="";c||""===c?p=c:l?p={id:"newtab-label-sponsored-by",values:{sponsor:l}}:a&&(p=a);const d={recommendations:e.spocs},h=`${this.props.type}_card`,m=P.createElement("div",{className:"ds-collection-card-grid"},P.createElement(Xe,{pocket_button_enabled:s,title:r,context:p,data:d,feed:i,type:h,is_collection:!0,dispatch:this.props.dispatch,items:this.props.items}));return t?P.createElement(Ze,{onDismissClick:this.onDismissClick,extraClasses:"ds-dismiss-ds-collection"},m):m}}function tt(){return tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},tt.apply(this,arguments)}function st(e){let t="a11y-link-button";return e.className&&(t+=` ${e.className}`),P.createElement("button",tt({type:"button"},e,{className:t}),e.children)}var nt=s(4975);class ot extends P.PureComponent{constructor(e){super(e),this.windowObj=this.props.windowObj||window,this.onClick=this.onClick.bind(this)}onClick(){this.windowObj.location.reload(!0)}render(){const e="as-error-fallback";let t;return t="className"in this.props?`${this.props.className} ${e}`:e,P.createElement("div",{className:t},P.createElement("div",{"data-l10n-id":"newtab-error-fallback-info"}),P.createElement("span",null,P.createElement(st,{className:"reload-button",onClick:this.onClick,"data-l10n-id":"newtab-error-fallback-refresh-link"})))}}ot.defaultProps={className:"as-error-fallback"};class it extends P.PureComponent{constructor(e){super(e),this.state={hasError:!1}}componentDidCatch(e,t){this.setState({hasError:!0})}render(){return this.state.hasError?P.createElement(this.props.FallbackComponent,{className:this.props.className}):this.props.children}}it.defaultProps={FallbackComponent:ot};class rt extends nt.SV{render(){return this.state.error?P.createElement(this.props.FallbackComponent,{className:this.props.className}):this.props.children}}rt.defaultProps={FallbackComponent:ot};class at extends P.PureComponent{constructor(e){super(e),this.onBodyMount=this.onBodyMount.bind(this),this.onMenuButtonMouseEnter=this.onMenuButtonMouseEnter.bind(this),this.onMenuButtonMouseLeave=this.onMenuButtonMouseLeave.bind(this),this.onMenuUpdate=this.onMenuUpdate.bind(this),this.state={menuButtonHover:!1,showContextMenu:!1},this.setContextMenuButtonRef=this.setContextMenuButtonRef.bind(this)}setContextMenuButtonRef(e){this.contextMenuButtonRef=e}onBodyMount(e){this.sectionBody=e}onMenuButtonMouseEnter(){this.setState({menuButtonHover:!0})}onMenuButtonMouseLeave(){this.setState({menuButtonHover:!1})}onMenuUpdate(e){this.setState({showContextMenu:e})}render(){const{isAnimating:e,maxHeight:t,menuButtonHover:s,showContextMenu:n}=this.state,{id:o,collapsed:i,learnMore:r,title:a,subTitle:c}=this.props,l=s||n;let p,d;e&&!i?p={maxHeight:t}:!e&&i&&(p={display:"none"}),this.props.hideTitle&&(d={visibility:"hidden"});const h=c?"has-subtitle":"";return P.createElement("section",{className:`collapsible-section ${this.props.className}${l?" active":""}`,"data-section-id":o},P.createElement("div",{className:"section-top-bar"},P.createElement("h3",{className:`section-title-container ${h}`,style:d},P.createElement("span",{className:"section-title"},P.createElement(Le,{message:a})),P.createElement("span",{className:"learn-more-link-wrapper"},r&&P.createElement("span",{className:"learn-more-link"},P.createElement(Le,{message:r.link.message},P.createElement("a",{href:r.link.href})))),c&&P.createElement("span",{className:"section-sub-title"},P.createElement(Le,{message:c})))),P.createElement(rt,{className:"section-body-fallback"},P.createElement("div",{ref:this.onBodyMount,style:p},this.props.children)))}}at.defaultProps={document:s.g.document||{addEventListener:()=>{},removeEventListener:()=>{},visibilityState:"hidden"}};const ct=(0,oe.$j)((e=>({Prefs:e.Prefs})))(at);class lt extends P.PureComponent{render(){return P.createElement("div",{className:"ds-message"},P.createElement("header",{className:"title"},this.props.icon&&P.createElement("div",{className:"glyph",style:{backgroundImage:`url(${this.props.icon})`}}),this.props.title&&P.createElement("span",{className:"title-text"},P.createElement(Le,{message:this.props.title})),this.props.link_text&&this.props.link_url&&P.createElement(Pe,{className:"link",url:this.props.link_url},P.createElement(Le,{message:this.props.link_text}))))}}class pt extends P.PureComponent{constructor(e){super(e),this.onKeyDown=this.onKeyDown.bind(this)}onKeyDown(e){"Escape"===e.key&&this.props.onClose(e)}componentWillMount(){this.props.document.addEventListener("keydown",this.onKeyDown),this.props.document.body.classList.add("modal-open")}componentWillUnmount(){this.props.document.removeEventListener("keydown",this.onKeyDown),this.props.document.body.classList.remove("modal-open")}render(){const{props:e}=this;let t=e.unstyled?"":"modalOverlayInner active";return e.innerClassName&&(t+=` ${e.innerClassName}`),P.createElement("div",{className:"modalOverlayOuter active",onKeyDown:this.onKeyDown,role:"presentation"},P.createElement("div",{className:t,"aria-labelledby":e.headerId,id:e.id,role:"dialog"},e.children))}}pt.defaultProps={document:s.g.document};class dt extends P.PureComponent{constructor(e){super(e),this.closeModal=this.closeModal.bind(this),this.onLearnLinkClick=this.onLearnLinkClick.bind(this),this.onManageLinkClick=this.onManageLinkClick.bind(this)}onLearnLinkClick(e){this.props.dispatch(g.DiscoveryStreamUserEvent({event:"CLICK_PRIVACY_INFO",source:"DS_PRIVACY_MODAL"}))}onManageLinkClick(e){this.props.dispatch(g.OnlyToMain({type:u.SETTINGS_OPEN}))}closeModal(){this.props.dispatch({type:"HIDE_PRIVACY_INFO",data:{}})}render(){return P.createElement(pt,{onClose:this.closeModal,innerClassName:"ds-privacy-modal"},P.createElement("div",{className:"privacy-notice"},P.createElement("h3",{"data-l10n-id":"newtab-privacy-modal-header"}),P.createElement("p",{"data-l10n-id":"newtab-privacy-modal-paragraph-2"}),P.createElement("a",{className:"modal-link modal-link-privacy","data-l10n-id":"newtab-privacy-modal-link",onClick:this.onLearnLinkClick,href:"https://help.getpocket.com/article/1142-firefox-new-tab-recommendations-faq"}),P.createElement("button",{className:"modal-link modal-link-manage","data-l10n-id":"newtab-privacy-modal-button-manage",onClick:this.onManageLinkClick})),P.createElement("section",{className:"actions"},P.createElement("button",{className:"done",type:"submit",onClick:this.closeModal,"data-l10n-id":"newtab-privacy-modal-button-done"})))}}class ht extends P.PureComponent{constructor(e){super(e),this.state={active:!1,lastItem:!1},this.onMenuButtonUpdate=this.onMenuButtonUpdate.bind(this),this.onLinkClick=this.onLinkClick.bind(this),this.onMenuShow=this.onMenuShow.bind(this)}onMenuButtonUpdate(e){e||this.setState({active:!1,lastItem:!1})}nextAnimationFrame(){return new Promise((e=>this.props.windowObj.requestAnimationFrame(e)))}async onMenuShow(){let{lastItem:e}=this.state;await this.nextAnimationFrame(),this.props.windowObj.scrollMaxX>0&&(e=!0),this.setState({active:!0,lastItem:e})}onLinkClick(){const{data:e}=this.props;if(this.props.dispatch&&e&&e.spocs&&e.spocs.length){const t=this.props.type.toUpperCase(),[s]=e.spocs;this.props.dispatch(g.DiscoveryStreamUserEvent({event:"CLICK",source:t,action_position:0})),this.props.dispatch(g.ImpressionStats({source:t,click:0,tiles:[{id:s.id,pos:0,...s.shim&&s.shim.click?{shim:s.shim.click}:{}}]}))}}render(){const{data:e,dispatch:t,type:s}=this.props;if(!e||!e.spocs||!e.spocs[0])return null;const[n]=e.spocs,{title:o,url:i,excerpt:r,flight_id:a,id:c,shim:l}=n,p=["OpenInNewWindow","OpenInPrivateWindow","Separator","BlockUrl",...a?["ShowPrivacyInfo"]:[]],d=["ds-signup",this.state.active&&"active",this.state.lastItem&&"last-item"].filter((e=>e)).join(" ");return P.createElement("div",{className:d},P.createElement("div",{className:"ds-signup-content"},P.createElement("span",{className:"icon icon-small-spacer icon-mail"}),P.createElement("span",null,o," ",P.createElement(Pe,{className:"ds-chevron-link",dispatch:t,onLinkClick:this.onLinkClick,url:i},r)),P.createElement(Ne,{flightId:a,rows:[{id:c,pos:0,shim:l&&l.impression}],dispatch:t,source:s})),P.createElement(ve,{tooltip:"newtab-menu-content-tooltip",tooltipArgs:{title:o},onUpdate:this.onMenuButtonUpdate},P.createElement(ge,{dispatch:t,index:0,source:s.toUpperCase(),onShow:this.onMenuShow,options:p,shouldSendImpressionStats:!0,userEvent:g.DiscoveryStreamUserEvent,site:{referrer:"https://getpocket.com/recommendations",title:o,type:s,url:i,guid:c,shim:l,flight_id:a}})))}}ht.defaultProps={windowObj:window};class mt extends P.PureComponent{constructor(e){super(e),this.onLinkClick=this.onLinkClick.bind(this),this.onDismissClick=this.onDismissClick.bind(this)}onLinkClick(){const{data:e}=this.props;if(this.props.dispatch&&e&&e.spocs&&e.spocs.length){const t=this.props.type.toUpperCase(),[s]=e.spocs;this.props.dispatch(g.DiscoveryStreamUserEvent({event:"CLICK",source:t,action_position:0})),this.props.dispatch(g.ImpressionStats({source:t,click:0,tiles:[{id:s.id,pos:0,...s.shim&&s.shim.click?{shim:s.shim.click}:{}}]}))}}onDismissClick(){const{data:e}=this.props;if(this.props.dispatch&&e&&e.spocs&&e.spocs.length){const t=0,s=this.props.type.toUpperCase(),[n]=e.spocs,o={url:n.url,guid:n.id,shim:n.shim},i=Ee.BlockUrl(o,t,s),{action:r,impression:a,userEvent:c}=i;this.props.dispatch(r),this.props.dispatch(g.DiscoveryStreamUserEvent({event:c,source:s,action_position:t})),a&&this.props.dispatch(a)}}render(){const{data:e}=this.props;if(!e||!e.spocs||!e.spocs[0])return null;const[t]=e.spocs,{image_src:s,raw_image_src:n,alt_text:o,title:i,url:r,context:a,cta:c,flight_id:l,id:p,shim:d}=t;return P.createElement(Ze,{onDismissClick:this.onDismissClick,extraClasses:"ds-dismiss-ds-text-promo"},P.createElement("div",{className:"ds-text-promo"},P.createElement(de,{alt_text:o,source:s,rawSource:n}),P.createElement("div",{className:"text"},P.createElement("h3",null,`${i} `,P.createElement(Pe,{className:"ds-chevron-link",dispatch:this.props.dispatch,onLinkClick:this.onLinkClick,url:r},c)),P.createElement("p",{className:"subtitle"},a)),P.createElement(Ne,{flightId:l,rows:[{id:p,pos:0,shim:d&&d.impression}],dispatch:this.props.dispatch,source:this.props.type})))}}const ut={isBlob:(e,t)=>!!(t&&t.path&&(!e&&t.data||e&&t.url)),createLocalImageObject(e){return e?this.isBlob(!1,e)?{url:s.g.URL.createObjectURL(e.data),path:e.path}:{url:e}:null},maybeRevokeBlobObjectURL(e){this.isBlob(!0,e)&&s.g.URL.revokeObjectURL(e.url)},isRemoteImageLocal(e,t){return t&&e?this.isBlob(!1,t)?e.path===t.path:e.url===t:!t&&!e}},Et=new Map;class St extends P.PureComponent{constructor(e){super(e),this.state={activeCard:null,imageLoaded:!1,cardImage:null},this.onMenuButtonUpdate=this.onMenuButtonUpdate.bind(this),this.onLinkClick=this.onLinkClick.bind(this)}async maybeLoadImage(){const{cardImage:e}=this.state;if(!e)return;const t=e.url;if(!this.state.imageLoaded){if(!Et.has(t)){const e=new Promise(((e,s)=>{const n=new Image;n.addEventListener("load",e),n.addEventListener("error",s),n.src=t}));Et.set(t,e),e.catch((e=>e)).then((()=>Et.delete(t))).catch()}try{await Et.get(t)}catch(e){return}ut.isRemoteImageLocal(this.state.cardImage,this.props.link.image)&&!this.state.imageLoaded&&this.setState({imageLoaded:!0})}}static getNextStateFromProps(e,t){const{image:s}=e.link,n=ut.isRemoteImageLocal(t.cardImage,s);let o=null;return!n&&e.link&&(o={imageLoaded:!1}),n||(ut.maybeRevokeBlobObjectURL(t.cardImage),o=o||{},o.cardImage=ut.createLocalImageObject(s)),o}onMenuButtonUpdate(e){e?this.setState({activeCard:this.props.index}):this.setState({activeCard:null})}_getTelemetryInfo(){return"history"!==this.props.link.type?{value:{card_type:this.props.link.type}}:null}onLinkClick(e){e.preventDefault();const{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i}=e;"download"===this.props.link.type?this.props.dispatch(g.OnlyToMain({type:u.OPEN_DOWNLOAD_FILE,data:Object.assign(this.props.link,{event:{button:s,ctrlKey:n,metaKey:o,shiftKey:i}})})):this.props.dispatch(g.OnlyToMain({type:u.OPEN_LINK,data:Object.assign(this.props.link,{event:{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i}})})),this.props.isWebExtension?this.props.dispatch(g.WebExtEvent(u.WEBEXT_CLICK,{source:this.props.eventSource,url:this.props.link.url,action_position:this.props.index})):(this.props.dispatch(g.UserEvent(Object.assign({event:"CLICK",source:this.props.eventSource,action_position:this.props.index},this._getTelemetryInfo()))),this.props.shouldSendImpressionStats&&this.props.dispatch(g.ImpressionStats({source:this.props.eventSource,click:0,tiles:[{id:this.props.link.guid,pos:this.props.index}]})))}componentDidMount(){this.maybeLoadImage()}componentDidUpdate(){this.maybeLoadImage()}componentWillMount(){const e=St.getNextStateFromProps(this.props,this.state);e&&this.setState(e)}componentWillReceiveProps(e){const t=St.getNextStateFromProps(e,this.state);t&&this.setState(t)}componentWillUnmount(){ut.maybeRevokeBlobObjectURL(this.state.cardImage)}render(){const{index:e,className:t,link:s,dispatch:n,contextMenuOptions:o,eventSource:i,shouldSendImpressionStats:r}=this.props,{props:a}=this,c=s.title||s.hostname,l=this.state.activeCard===e,{icon:p,fluentID:d}=Re["now"===s.type?"trending":s.type]||{},h=this.state.cardImage||s.hasImage,m={backgroundImage:this.state.cardImage?`url(${this.state.cardImage.url})`:"none"},u=["card-outer",t,l&&"active",a.placeholder&&"placeholder"].filter((e=>e)).join(" ");return P.createElement("li",{className:u},P.createElement("a",{href:"pocket"===s.type?s.open_url:s.url,onClick:a.placeholder?void 0:this.onLinkClick},P.createElement("div",{className:"card"},P.createElement("div",{className:"card-preview-image-outer"},h&&P.createElement("div",{className:"card-preview-image"+(this.state.imageLoaded?" loaded":""),style:m})),P.createElement("div",{className:"card-details"},"download"===s.type&&P.createElement("div",{className:"card-host-name alternate","data-l10n-id":"newtab-menu-open-file"}),s.hostname&&P.createElement("div",{className:"card-host-name"},s.hostname.slice(0,100),"download"===s.type&&`  — ${s.description}`),P.createElement("div",{className:["card-text",p?"":"no-context",s.description?"":"no-description",s.hostname?"":"no-host-name"].join(" ")},P.createElement("h4",{className:"card-title",dir:"auto"},s.title),P.createElement("p",{className:"card-description",dir:"auto"},s.description)),P.createElement("div",{className:"card-context"},p&&!s.context&&P.createElement("span",{"aria-haspopup":"true",className:`card-context-icon icon icon-${p}`}),s.icon&&s.context&&P.createElement("span",{"aria-haspopup":"true",className:"card-context-icon icon",style:{backgroundImage:`url('${s.icon}')`}}),d&&!s.context&&P.createElement("div",{className:"card-context-label","data-l10n-id":d}),s.context&&P.createElement("div",{className:"card-context-label"},s.context))))),!a.placeholder&&P.createElement(ve,{tooltip:"newtab-menu-content-tooltip",tooltipArgs:{title:c},onUpdate:this.onMenuButtonUpdate},P.createElement(ge,{dispatch:n,index:e,source:i,options:s.contextMenuOptions||o,site:s,siteInfo:this._getTelemetryInfo(),shouldSendImpressionStats:r})))}}St.defaultProps={link:{}};const _t=(0,oe.$j)((e=>({platform:e.Prefs.values.platform})))(St),gt=e=>P.createElement(_t,{placeholder:!0,className:e.className});let vt=window.performance;function ft(e){e&&e.performanceObj?this._perf=e.performanceObj:this._perf=vt}ft.prototype={mark:function(e){this._perf.mark(e)},getEntriesByName:function(e,t){return this._perf.getEntriesByName(e,t)},get timeOrigin(){return this._perf.timeOrigin},absNow:function(){return this.timeOrigin+this._perf.now()},getMostRecentAbsMarkStartByName(e){let t=this.getEntriesByName(e,"mark");if(!t.length)throw new Error(`No marks with the name ${e}`);let s=t[t.length-1];return this._perf.timeOrigin+s.startTime}};const bt=new ft,Ct=["highlights","topsites"];class yt extends P.Component{constructor(e){super(e),this.perfSvc=this.props.perfSvc||bt,this._sendBadStateEvent=this._sendBadStateEvent.bind(this),this._sendPaintedEvent=this._sendPaintedEvent.bind(this),this._reportMissingData=!1,this._timestampHandled=!1,this._recordedFirstRender=!1}componentDidMount(){Ct.includes(this.props.id)&&this._maybeSendPaintedEvent()}componentDidUpdate(){Ct.includes(this.props.id)&&this._maybeSendPaintedEvent()}_afterFramePaint(e){requestAnimationFrame((()=>setTimeout(e,0)))}_maybeSendBadStateEvent(){this.props.initialized?this._reportMissingData&&(this._reportMissingData=!1,this._sendBadStateEvent()):this._reportMissingData=!0}_maybeSendPaintedEvent(){!this._timestampHandled&&this.props.initialized&&(this._timestampHandled=!0,this._afterFramePaint(this._sendPaintedEvent))}_ensureFirstRenderTsRecorded(){if(!this._recordedFirstRender){this._recordedFirstRender=!0;const e=`${this.props.id}_first_render_ts`;this.perfSvc.mark(e)}}_sendBadStateEvent(){const e=`${this.props.id}_data_ready_ts`;this.perfSvc.mark(e);try{const t=`${this.props.id}_first_render_ts`,s=parseInt(this.perfSvc.getMostRecentAbsMarkStartByName(e)-this.perfSvc.getMostRecentAbsMarkStartByName(t),10);this.props.dispatch(g.OnlyToMain({type:u.SAVE_SESSION_PERF_DATA,data:{[`${this.props.id}_data_late_by_ms`]:s}}))}catch(e){}}_sendPaintedEvent(){if("topsites"!==this.props.id)return;const e=`${this.props.id}_first_painted_ts`;this.perfSvc.mark(e);try{const t={};t[e]=this.perfSvc.getMostRecentAbsMarkStartByName(e),this.props.dispatch(g.OnlyToMain({type:u.SAVE_SESSION_PERF_DATA,data:t}))}catch(e){}}render(){return Ct.includes(this.props.id)&&(this._ensureFirstRenderTsRecorded(),this._maybeSendBadStateEvent()),this.props.children}}class kt extends P.PureComponent{render(){const{read_more_endpoint:e}=this.props;return e?P.createElement("a",{className:"more-recommendations",href:e,"data-l10n-id":"newtab-pocket-more-recommendations"}):null}}class Ot extends P.PureComponent{render(){const{url:e,name:t}=this.props;return P.createElement("li",null,P.createElement("a",{key:t,href:e},t))}}class Tt extends P.PureComponent{render(){const{topics:e}=this.props;return P.createElement("span",{className:"topics"},P.createElement("span",{"data-l10n-id":"newtab-pocket-read-more"}),P.createElement("ul",null,e&&e.map((e=>P.createElement(Ot,{key:e.name,url:e.url,name:e.name})))))}}const wt=new class{constructor(e){this.createKey=e||this.defaultCreateKey}defaultCreateKey(e){return e}group(...e){const t=new Set,s=[];for(const n of e){const e=new Map;for(const s of n){const n=this.createKey(s);t.has(n)||e.has(n)||e.set(n,s)}s.push(e),e.forEach(((e,s)=>t.add(s)))}return s.map((e=>Array.from(e.values())))}}((e=>e&&e.url)),It={App:{initialized:!1,locale:""},ASRouter:{initialized:!1},Snippets:{initialized:!1},TopSites:{initialized:!1,rows:[],editForm:null,showSearchShortcutsForm:!1,searchShortcuts:[]},MoCoCNPrefs:{initialized:!1,values:{}},Prefs:{initialized:!1,values:{featureConfig:{}}},Dialog:{visible:!1,data:{}},Sections:[],Pocket:{isUserLoggedIn:null,pocketCta:{},waitingForSpoc:!0},DiscoveryStream:{config:{enabled:!1,layout_endpoint:""},layout:[],lastUpdated:null,isPrivacyInfoModalVisible:!1,isCollectionDismissible:!1,feeds:{data:{},loaded:!1},spocs:{spocs_endpoint:"",lastUpdated:null,data:{},loaded:!1,frequency_caps:[],blocked:[],placements:[]},experimentData:{utmSource:"pocket-newtab",utmCampaign:void 0,utmContent:void 0},recentSavesData:[],isUserLoggedIn:!1,recentSavesEnabled:!1},Personalization:{lastUpdated:null,initialized:!1},Search:{fakeFocus:!1,hide:!1}},Nt={TopSites:function(e=It.TopSites,t){let s,n;switch(t.type){case u.TOP_SITES_UPDATED:return t.data&&t.data.links?Object.assign({},e,{initialized:!0,rows:t.data.links},t.data.pref?{pref:t.data.pref}:{}):e;case u.TOP_SITES_PREFS_UPDATED:return Object.assign({},e,{pref:t.data.pref});case u.TOP_SITES_EDIT:return Object.assign({},e,{editForm:{index:t.data.index,previewResponse:null}});case u.TOP_SITES_CANCEL_EDIT:return Object.assign({},e,{editForm:null});case u.TOP_SITES_OPEN_SEARCH_SHORTCUTS_MODAL:return Object.assign({},e,{showSearchShortcutsForm:!0});case u.TOP_SITES_CLOSE_SEARCH_SHORTCUTS_MODAL:return Object.assign({},e,{showSearchShortcutsForm:!1});case u.PREVIEW_RESPONSE:return e.editForm&&t.data.url===e.editForm.previewUrl?Object.assign({},e,{editForm:{index:e.editForm.index,previewResponse:t.data.preview,previewUrl:t.data.url}}):e;case u.PREVIEW_REQUEST:return e.editForm?Object.assign({},e,{editForm:{index:e.editForm.index,previewResponse:null,previewUrl:t.data.url}}):e;case u.PREVIEW_REQUEST_CANCEL:return e.editForm?Object.assign({},e,{editForm:{index:e.editForm.index,previewResponse:null}}):e;case u.SCREENSHOT_UPDATED:return n=e.rows.map((e=>e&&e.url===t.data.url?(s=!0,Object.assign({},e,{screenshot:t.data.screenshot})):e)),s?Object.assign({},e,{rows:n}):e;case u.PLACES_BOOKMARK_ADDED:return t.data?(n=e.rows.map((e=>{if(e&&e.url===t.data.url){const{bookmarkGuid:s,bookmarkTitle:n,dateAdded:o}=t.data;return Object.assign({},e,{bookmarkGuid:s,bookmarkTitle:n,bookmarkDateCreated:o})}return e})),Object.assign({},e,{rows:n})):e;case u.PLACES_BOOKMARKS_REMOVED:return t.data?(n=e.rows.map((e=>{if(e&&t.data.urls.includes(e.url)){const t=Object.assign({},e);return delete t.bookmarkGuid,delete t.bookmarkTitle,delete t.bookmarkDateCreated,t}return e})),Object.assign({},e,{rows:n})):e;case u.PLACES_LINKS_DELETED:return t.data?(n=e.rows.filter((e=>!t.data.urls.includes(e.url))),Object.assign({},e,{rows:n})):e;case u.UPDATE_SEARCH_SHORTCUTS:return{...e,searchShortcuts:t.data.searchShortcuts};case u.SNIPPETS_PREVIEW_MODE:return{...e,rows:[]};default:return e}},App:function(e=It.App,t){return t.type===u.INIT?Object.assign({},e,t.data||{},{initialized:!0}):e},ASRouter:function(e=It.ASRouter,t){return t.type===u.AS_ROUTER_INITIALIZED?{...t.data,initialized:!0}:e},Snippets:function(e=It.Snippets,t){switch(t.type){case u.SNIPPETS_DATA:return Object.assign({},e,{initialized:!0},t.data);case u.SNIPPET_BLOCKED:return Object.assign({},e,{blockList:e.blockList.concat(t.data)});case u.SNIPPETS_BLOCKLIST_CLEARED:return Object.assign({},e,{blockList:[]});case u.SNIPPETS_RESET:return It.Snippets;default:return e}},MoCoCNPrefs:function(e=It.MoCoCNPrefs,t){let s;switch(t.type){case u.MOCOCN_PREFS_INITIAL_VALUES:return Object.assign({},e,{initialized:!0,values:t.data});case u.MOCOCN_PREF_CHANGED:return s=Object.assign({},e.values),s[t.data.name]=t.data.value,Object.assign({},e,{values:s});default:return e}},Prefs:function(e=It.Prefs,t){let s;switch(t.type){case u.PREFS_INITIAL_VALUES:return Object.assign({},e,{initialized:!0,values:t.data});case u.PREF_CHANGED:return s=Object.assign({},e.values),s[t.data.name]=t.data.value,Object.assign({},e,{values:s});default:return e}},Dialog:function(e=It.Dialog,t){switch(t.type){case u.DIALOG_OPEN:return Object.assign({},e,{visible:!0,data:t.data});case u.DIALOG_CANCEL:return Object.assign({},e,{visible:!1});case u.DELETE_HISTORY_URL:return Object.assign({},It.Dialog);default:return e}},Sections:function(e=It.Sections,t){let s,n;switch(t.type){case u.SECTION_DEREGISTER:return e.filter((e=>e.id!==t.data));case u.SECTION_REGISTER:if(n=e.map((e=>e&&e.id===t.data.id?(s=!0,Object.assign({},e,t.data)):e)),!s){const e=!(!t.data.rows||!t.data.rows.length),s=Object.assign({title:"",rows:[],enabled:!1},t.data,{initialized:e});n.push(s)}return n;case u.SECTION_UPDATE:return n=e.map((e=>{if(e&&e.id===t.data.id){const s=t.data.rows?{initialized:!0}:{};if(t.data.rows&&t.data.rows.length&&e.rows.find((e=>e.pinned))){const n=Array.from(t.data.rows);return e.rows.forEach(((e,t)=>{e.pinned&&n[t].guid!==e.guid&&n.splice(t,0,e)})),Object.assign({},e,s,Object.assign({},t.data,{rows:n}))}return Object.assign({},e,s,t.data)}return e})),t.data.dedupeConfigurations?(t.data.dedupeConfigurations.forEach((e=>{n=n.map((t=>{if(t.id===e.id){const s=e.dedupeFrom.reduce(((e,t)=>{const s=n.find((e=>e.id===t)),[,o]=wt.group(s.rows,e);return o}),t.rows);return Object.assign({},t,{rows:s})}return t}))})),n):n;case u.SECTION_UPDATE_CARD:return e.map((e=>{if(e&&e.id===t.data.id&&e.rows){const s=e.rows.map((e=>e.url===t.data.url?Object.assign({},e,t.data.options):e));return Object.assign({},e,{rows:s})}return e}));case u.PLACES_BOOKMARK_ADDED:return t.data?e.map((e=>Object.assign({},e,{rows:e.rows.map((e=>{if(e.url===t.data.url){const{bookmarkGuid:s,bookmarkTitle:n,dateAdded:o}=t.data;return Object.assign({},e,{bookmarkGuid:s,bookmarkTitle:n,bookmarkDateCreated:o,type:"bookmark"})}return e}))}))):e;case u.PLACES_SAVED_TO_POCKET:return t.data?e.map((e=>Object.assign({},e,{rows:e.rows.map((e=>e.url===t.data.url?Object.assign({},e,{open_url:t.data.open_url,pocket_id:t.data.pocket_id,title:t.data.title,type:"pocket"}):e))}))):e;case u.PLACES_BOOKMARKS_REMOVED:return t.data?e.map((e=>Object.assign({},e,{rows:e.rows.map((e=>{if(t.data.urls.includes(e.url)){const t=Object.assign({},e);return delete t.bookmarkGuid,delete t.bookmarkTitle,delete t.bookmarkDateCreated,t.type&&"bookmark"!==t.type||(t.type="history"),t}return e}))}))):e;case u.PLACES_LINKS_DELETED:return t.data?e.map((e=>Object.assign({},e,{rows:e.rows.filter((e=>!t.data.urls.includes(e.url)))}))):e;case u.PLACES_LINK_BLOCKED:return t.data?e.map((e=>Object.assign({},e,{rows:e.rows.filter((e=>e.url!==t.data.url))}))):e;case u.DELETE_FROM_POCKET:case u.ARCHIVE_FROM_POCKET:return e.map((e=>Object.assign({},e,{rows:e.rows.filter((e=>e.pocket_id!==t.data.pocket_id))})));case u.SNIPPETS_PREVIEW_MODE:return e.map((e=>({...e,rows:[]})));default:return e}},Pocket:function(e=It.Pocket,t){switch(t.type){case u.POCKET_WAITING_FOR_SPOC:return{...e,waitingForSpoc:t.data};case u.POCKET_LOGGED_IN:return{...e,isUserLoggedIn:!!t.data};case u.POCKET_CTA:return{...e,pocketCta:{ctaButton:t.data.cta_button,ctaText:t.data.cta_text,ctaUrl:t.data.cta_url,useCta:t.data.use_cta}};default:return e}},Personalization:function(e=It.Personalization,t){switch(t.type){case u.DISCOVERY_STREAM_PERSONALIZATION_LAST_UPDATED:return{...e,lastUpdated:t.data.lastUpdated};case u.DISCOVERY_STREAM_PERSONALIZATION_INIT:return{...e,initialized:!0};default:return e}},DiscoveryStream:function(e=It.DiscoveryStream,t){const s=()=>!t.data||!e.spocs.loaded||!e.feeds.loaded,n=t=>{const{data:s,placements:n}=e.spocs,o={},i=e=>{const n=s[e.name];n&&n.items&&n.items.length&&(o[e.name]={...n,items:t(n.items)})};return n&&n.length?n.forEach(i):[{name:"spocs"}].forEach(i),o},o=t=>({...e,spocs:{...e.spocs,data:n(t)},feeds:{...e.feeds,data:Object.keys(e.feeds.data).reduce(((s,n)=>(s[n]={data:{...e.feeds.data[n].data,recommendations:t(e.feeds.data[n].data.recommendations)}},s)),{})}});switch(t.type){case u.DISCOVERY_STREAM_CONFIG_CHANGE:case u.DISCOVERY_STREAM_CONFIG_SETUP:return{...e,config:t.data||{}};case u.DISCOVERY_STREAM_EXPERIMENT_DATA:return{...e,experimentData:t.data||{}};case u.DISCOVERY_STREAM_LAYOUT_UPDATE:return{...e,lastUpdated:t.data.lastUpdated||null,layout:t.data.layout||[]};case u.DISCOVERY_STREAM_COLLECTION_DISMISSIBLE_TOGGLE:return{...e,isCollectionDismissible:t.data.value};case u.DISCOVERY_STREAM_PREFS_SETUP:return{...e,recentSavesEnabled:t.data.recentSavesEnabled,pocketButtonEnabled:t.data.pocketButtonEnabled,saveToPocketCard:t.data.saveToPocketCard,hideDescriptions:t.data.hideDescriptions,compactImages:t.data.compactImages,imageGradient:t.data.imageGradient,newSponsoredLabel:t.data.newSponsoredLabel,titleLines:t.data.titleLines,descLines:t.data.descLines,readTime:t.data.readTime};case u.DISCOVERY_STREAM_RECENT_SAVES:return{...e,recentSavesData:t.data.recentSaves};case u.DISCOVERY_STREAM_POCKET_STATE_SET:return{...e,isUserLoggedIn:t.data.isUserLoggedIn};case u.HIDE_PRIVACY_INFO:return{...e,isPrivacyInfoModalVisible:!1};case u.SHOW_PRIVACY_INFO:return{...e,isPrivacyInfoModalVisible:!0};case u.DISCOVERY_STREAM_LAYOUT_RESET:return{...It.DiscoveryStream,config:e.config};case u.DISCOVERY_STREAM_FEEDS_UPDATE:return{...e,feeds:{...e.feeds,loaded:!0}};case u.DISCOVERY_STREAM_FEED_UPDATE:const n={};return n[t.data.url]=t.data.feed,{...e,feeds:{...e.feeds,data:{...e.feeds.data,...n}}};case u.DISCOVERY_STREAM_SPOCS_CAPS:return{...e,spocs:{...e.spocs,frequency_caps:[...e.spocs.frequency_caps,...t.data]}};case u.DISCOVERY_STREAM_SPOCS_ENDPOINT:return{...e,spocs:{...It.DiscoveryStream.spocs,spocs_endpoint:t.data.url||It.DiscoveryStream.spocs.spocs_endpoint}};case u.DISCOVERY_STREAM_SPOCS_PLACEMENTS:return{...e,spocs:{...e.spocs,placements:t.data.placements||It.DiscoveryStream.spocs.placements}};case u.DISCOVERY_STREAM_SPOCS_UPDATE:return t.data?{...e,spocs:{...e.spocs,lastUpdated:t.data.lastUpdated,data:t.data.spocs,loaded:!0}}:e;case u.DISCOVERY_STREAM_SPOC_BLOCKED:return{...e,spocs:{...e.spocs,blocked:[...e.spocs.blocked,t.data.url]}};case u.DISCOVERY_STREAM_LINK_BLOCKED:return s()?e:o((e=>e.filter((e=>e.url!==t.data.url))));case u.PLACES_SAVED_TO_POCKET:const i=e=>e.url===t.data.url?Object.assign({},e,{open_url:t.data.open_url,pocket_id:t.data.pocket_id,context_type:"pocket"}):e;return s()?e:o((e=>e.map(i)));case u.DELETE_FROM_POCKET:case u.ARCHIVE_FROM_POCKET:return s()?e:o((e=>e.filter((e=>e.pocket_id!==t.data.pocket_id))));case u.PLACES_BOOKMARK_ADDED:const r=e=>{if(e.url===t.data.url){const{bookmarkGuid:s,bookmarkTitle:n,dateAdded:o}=t.data;return Object.assign({},e,{bookmarkGuid:s,bookmarkTitle:n,bookmarkDateCreated:o,context_type:"bookmark"})}return e};return s()?e:o((e=>e.map(r)));case u.PLACES_BOOKMARKS_REMOVED:const a=e=>{if(t.data.urls.includes(e.url)){const t=Object.assign({},e);return delete t.bookmarkGuid,delete t.bookmarkTitle,delete t.bookmarkDateCreated,t.context_type&&"bookmark"!==t.context_type||(t.context_type="removedBookmark"),t}return e};return s()?e:o((e=>e.map(a)));case u.PREF_CHANGED:return"discoverystream.isCollectionDismissible"===t.data.name?{...e,isCollectionDismissible:t.data.value}:e;default:return e}},Search:function(e=It.Search,t){switch(t.type){case u.DISABLE_SEARCH:return Object.assign({...e,disable:!0});case u.FAKE_FOCUS_SEARCH:return Object.assign({...e,fakeFocus:!0});case u.SHOW_SEARCH:return Object.assign({...e,disable:!1,fakeFocus:!1});default:return e}}};class Pt extends P.PureComponent{constructor(e){super(e),this.state={validationError:this.props.validationError},this.onChange=this.onChange.bind(this),this.onMount=this.onMount.bind(this),this.onClearIconPress=this.onClearIconPress.bind(this)}componentWillReceiveProps(e){e.shouldFocus&&!this.props.shouldFocus&&this.input.focus(),e.validationError&&!this.props.validationError&&this.setState({validationError:!0}),this.state.validationError&&!e.value&&this.setState({validationError:!1})}onClearIconPress(e){"Enter"===e.key&&this.props.onClear()}onChange(e){this.state.validationError&&this.setState({validationError:!1}),this.props.onChange(e)}onMount(e){this.input=e}renderLoadingOrCloseButton(){const e=this.props.value&&this.props.onClear;return this.props.loading?P.createElement("div",{className:"loading-container"},P.createElement("div",{className:"loading-animation"})):e?P.createElement("button",{type:"button",className:"icon icon-clear-input icon-button-style",onClick:this.props.onClear,onKeyPress:this.onClearIconPress}):null}render(){const{typeUrl:e}=this.props,{validationError:t}=this.state;return P.createElement("label",null,P.createElement("span",{"data-l10n-id":this.props.titleId}),P.createElement("div",{className:`field ${e?"url":""}${t?" invalid":""}`},P.createElement("input",{type:"text",value:this.props.value,ref:this.onMount,onChange:this.onChange,"data-l10n-id":this.props.placeholderId,autoFocus:this.props.autoFocusOnOpen,disabled:this.props.loading}),this.renderLoadingOrCloseButton(),t&&P.createElement("aside",{className:"error-tooltip","data-l10n-id":this.props.errorMessageId})))}}Pt.defaultProps={showClearButton:!1,value:"",validationError:!1};const Rt="visible",At="visibilitychange";class Dt extends P.PureComponent{_dispatchImpressionStats(){const{actionType:e,tile:t}=this.props;e&&this.props.dispatch(g.OnlyToMain({type:e,data:{type:"impression",...t}}))}setImpressionObserverOrAddListener(){const{props:e}=this;e.dispatch&&(e.document.visibilityState===Rt?this.setImpressionObserver():(this._onVisibilityChange&&e.document.removeEventListener(At,this._onVisibilityChange),this._onVisibilityChange=()=>{e.document.visibilityState===Rt&&(this.setImpressionObserver(),e.document.removeEventListener(At,this._onVisibilityChange))},e.document.addEventListener(At,this._onVisibilityChange)))}setImpressionObserver(){const{props:e}=this;if(!e.tile)return;this._handleIntersect=e=>{e.some((e=>e.isIntersecting&&e.intersectionRatio>=.5))&&(this._dispatchImpressionStats(),this.impressionObserver.unobserve(this.refs.topsite_impression_wrapper))};this.impressionObserver=new e.IntersectionObserver(this._handleIntersect,{threshold:.5}),this.impressionObserver.observe(this.refs.topsite_impression_wrapper)}componentDidMount(){this.props.tile&&this.setImpressionObserverOrAddListener()}componentWillUnmount(){this._handleIntersect&&this.impressionObserver&&this.impressionObserver.unobserve(this.refs.topsite_impression_wrapper),this._onVisibilityChange&&this.props.document.removeEventListener(At,this._onVisibilityChange)}render(){return P.createElement("div",{ref:"topsite_impression_wrapper",className:"topsite-impression-observer"},this.props.children)}}function Lt(){return Lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Lt.apply(this,arguments)}Dt.defaultProps={IntersectionObserver:s.g.IntersectionObserver,document:s.g.document,actionType:null,tile:null};const Mt="SPOC",xt="newtab";function Ut(e){return(null==e?void 0:e.sponsored_position)||(null==e?void 0:e.type)===Mt}class Bt extends P.PureComponent{constructor(e){super(e),this.state={screenshotImage:null},this.onDragEvent=this.onDragEvent.bind(this),this.onKeyPress=this.onKeyPress.bind(this)}_allowDrop(e){return(this.dragged||!Ut(this.props.link))&&e.dataTransfer.types.includes("text/topsite-index")}onDragEvent(e){switch(e.type){case"click":this.dragged&&e.preventDefault();break;case"dragstart":if(e.target.blur(),Ut(this.props.link)){e.preventDefault();break}this.dragged=!0,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/topsite-index",this.props.index),this.props.onDragEvent(e,this.props.index,this.props.link,this.props.title);break;case"dragend":this.props.onDragEvent(e);break;case"dragenter":case"dragover":case"drop":this._allowDrop(e)&&(e.preventDefault(),this.props.onDragEvent(e,this.props.index));break;case"mousedown":1===e.button&&this.props.link.searchTopSite&&e.preventDefault(),this.dragged=!1}}static getNextStateFromProps(e,t){const{screenshot:s}=e.link;return ut.isRemoteImageLocal(t.screenshotImage,s)?null:(ut.maybeRevokeBlobObjectURL(t.screenshotImage),{screenshotImage:ut.createLocalImageObject(s)})}componentWillMount(){const e=Bt.getNextStateFromProps(this.props,this.state);e&&this.setState(e)}componentWillReceiveProps(e){const t=Bt.getNextStateFromProps(e,this.state);t&&this.setState(t)}componentWillUnmount(){ut.maybeRevokeBlobObjectURL(this.state.screenshotImage)}onKeyPress(e){this.props.link.searchTopSite&&"Enter"===e.key&&this.props.onClick(e)}generateColor(){let{title:e,colors:t}=this.props;if(!t)return"";let s=t.split(",");return s[(e=>{let t=0;for(let s=0;s<e.length;s++)t+=e.charCodeAt(s);return t})(e)%s.length]}calculateStyle(){const{defaultStyle:e,link:t}=this.props,{tippyTopIcon:s,faviconSize:n}=t;let o,i,r,a,c="icon-wrapper",l=!1,p=this.state.screenshotImage&&this.state.screenshotImage.url;return e?(a=this.generateColor(),c=`${c} letter-fallback`):t.searchTopSite?(o="top-site-icon rich-icon",i={backgroundColor:t.backgroundColor,backgroundImage:`url(${s})`},r={backgroundImage:`url(${s})`}):t.customScreenshotURL?(c="",o="top-site-icon rich-icon",i={backgroundColor:t.backgroundColor,backgroundImage:p?`url(${this.state.screenshotImage.url})`:""}):s||t.type===Mt||n>=96?(o="top-site-icon rich-icon",i={backgroundColor:t.backgroundColor,backgroundImage:`url(${s||t.favicon})`}):n>=(M?48:16)?(l=!0,r={backgroundImage:`url(${t.favicon})`}):(a=this.generateColor(),o="",c=`${c} letter-fallback`),{showSmallFavicon:l,smallFaviconStyle:r,imageStyle:i,imageClassName:o,iconWrapperClass:c,selectedColor:a}}render(){const{children:e,className:t,isDraggable:s,link:n,onClick:o,title:i}=this.props,r=`top-site-outer${t?` ${t}`:""}${n.isDragged?" dragged":""}${n.searchTopSite?" search-shortcut":""}`,[a]=i,{showSmallFavicon:c,smallFaviconStyle:l,imageStyle:p,imageClassName:d,iconWrapperClass:h,selectedColor:m}=this.calculateStyle();let E={};s&&(E={onClick:this.onDragEvent,onDragEnd:this.onDragEvent,onDragStart:this.onDragEvent,onMouseDown:this.onDragEvent});let S=null;return S=n.type===Mt?P.createElement(Ne,{flightId:n.flightId,rows:[{id:n.id,pos:n.pos,shim:n.shim&&n.shim.impression,advertiser:i.toLocaleLowerCase()}],dispatch:this.props.dispatch,source:be}):Ut(n)?P.createElement(Dt,{actionType:u.TOP_SITES_SPONSORED_IMPRESSION_STATS,tile:{position:this.props.index+1,tile_id:n.sponsored_tile_id||-1,reporting_url:n.sponsored_impression_url,advertiser:i.toLocaleLowerCase(),source:xt},IntersectionObserver:this.props.IntersectionObserver,document:this.props.document,dispatch:this.props.dispatch}):P.createElement(Dt,{actionType:u.TOP_SITES_ORGANIC_IMPRESSION_STATS,tile:{source:xt},IntersectionObserver:this.props.IntersectionObserver,document:this.props.document,dispatch:this.props.dispatch}),P.createElement("li",Lt({className:r,onDrop:this.onDragEvent,onDragOver:this.onDragEvent,onDragEnter:this.onDragEvent,onDragLeave:this.onDragEvent},E),P.createElement("div",{className:"top-site-inner"},P.createElement("a",{className:"top-site-button",href:n.searchTopSite?void 0:n.url,tabIndex:"0",onKeyPress:this.onKeyPress,onClick:o,draggable:!0,"data-is-sponsored-link":!!n.sponsored_tile_id},P.createElement("div",{className:"tile","aria-hidden":!0},P.createElement("div",{className:h,"data-fallback":a,style:m?{backgroundColor:m}:{}},P.createElement("div",{className:d,style:p}),c&&P.createElement("div",{className:"top-site-icon default-icon","data-fallback":l?"":a,style:l})),n.searchTopSite&&P.createElement("div",{className:"top-site-icon search-topsite"})),P.createElement("div",{className:`title${n.isPinned?" has-icon pinned":""}${n.type===Mt||n.show_sponsored_label?" sponsored":""}`},P.createElement("span",{dir:"auto"},n.isPinned&&P.createElement("div",{className:"icon icon-pin-small"}),i||P.createElement("br",null),P.createElement("span",{className:"sponsored-label","data-l10n-id":"newtab-topsite-sponsored"})))),e,S))}}Bt.defaultProps={title:"",link:{},isDraggable:!0};class Ft extends P.PureComponent{constructor(e){super(e),this.state={showContextMenu:!1},this.onLinkClick=this.onLinkClick.bind(this),this.onMenuUpdate=this.onMenuUpdate.bind(this)}_getTelemetryInfo(){const e={icon_type:this.props.link.iconType};return this.props.link.isPinned&&(e.card_type="pinned"),this.props.link.searchTopSite&&(e.card_type="search",e.search_vendor=this.props.link.hostname),Ut(this.props.link)&&(e.card_type="spoc"),{value:e}}userEvent(e){this.props.dispatch(g.UserEvent(Object.assign({event:e,source:be,action_position:this.props.index},this._getTelemetryInfo())))}onLinkClick(e){this.userEvent("CLICK"),e.preventDefault();const{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i}=e;if(this.props.link.searchTopSite)this.props.dispatch(g.OnlyToMain({type:u.FILL_SEARCH_TERM,data:{label:this.props.link.label}}));else{if(this.props.dispatch(g.OnlyToMain({type:u.OPEN_LINK,data:Object.assign(this.props.link,{event:{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i}})})),this.props.link.type===Mt){this.props.dispatch(g.ImpressionStats({source:be,click:0,tiles:[{id:this.props.link.id,pos:this.props.link.pos,shim:this.props.link.shim&&this.props.link.shim.click}]}));const e=this.props.link.label||this.props.link.hostname;this.props.dispatch(g.OnlyToMain({type:u.TOP_SITES_SPONSORED_IMPRESSION_STATS,data:{type:"click",position:this.props.link.pos+1,tile_id:this.props.link.id,advertiser:e.toLocaleLowerCase(),source:xt}}))}else if(Ut(this.props.link)){const e=this.props.link.label||this.props.link.hostname;this.props.dispatch(g.OnlyToMain({type:u.TOP_SITES_SPONSORED_IMPRESSION_STATS,data:{type:"click",position:this.props.index+1,tile_id:this.props.link.sponsored_tile_id||-1,reporting_url:this.props.link.sponsored_click_url,advertiser:e.toLocaleLowerCase(),source:xt}}))}else this.props.dispatch(g.OnlyToMain({type:u.TOP_SITES_ORGANIC_IMPRESSION_STATS,data:{type:"click",source:xt}}));this.props.link.sendAttributionRequest&&this.props.dispatch(g.OnlyToMain({type:u.PARTNER_LINK_ATTRIBUTION,data:{targetURL:this.props.link.url,source:"newtab"}}))}}onMenuUpdate(e){e?this.props.onActivate(this.props.index):this.props.onActivate()}render(){const{props:e}=this,{link:t}=e,s=e.activeIndex===e.index,n=t.label||t.hostname;let o;return o=M?Te:t.sponsored_position?ke:t.searchTopSite?Oe:t.type===Mt?ye:Ce,P.createElement(Bt,Lt({},e,{onClick:this.onLinkClick,onDragEvent:this.props.onDragEvent,className:`${e.className||""}${s?" active":""}`,title:n}),P.createElement("div",null,P.createElement(ve,{tooltip:"newtab-menu-content-tooltip",tooltipArgs:{title:n},onUpdate:this.onMenuUpdate},P.createElement(ge,{dispatch:e.dispatch,index:e.index,onUpdate:this.onMenuUpdate,options:o,site:t,shouldSendImpressionStats:t.type===Mt,siteInfo:this._getTelemetryInfo(),source:be}))))}}Ft.defaultProps={link:{},onActivate(){}};class Kt extends P.PureComponent{constructor(e){super(e),this.onEditButtonClick=this.onEditButtonClick.bind(this)}onEditButtonClick(){this.props.dispatch({type:u.TOP_SITES_EDIT,data:{index:this.props.index}})}render(){return P.createElement(Bt,Lt({},this.props,{className:`placeholder ${this.props.className||""}`,isDraggable:!1}),P.createElement("button",{"aria-haspopup":"dialog",className:"context-menu-button edit-button icon","data-l10n-id":"newtab-menu-topsites-placeholder-tooltip",onClick:this.onEditButtonClick}))}}class Vt extends P.PureComponent{static get DEFAULT_STATE(){return{activeIndex:null,draggedIndex:null,draggedSite:null,draggedTitle:null,topSitesPreview:null}}constructor(e){super(e),this.state=Vt.DEFAULT_STATE,this.onDragEvent=this.onDragEvent.bind(this),this.onActivate=this.onActivate.bind(this)}componentWillReceiveProps(e){if(this.state.draggedSite){const t=this.props.TopSites&&this.props.TopSites.rows,s=e.TopSites&&e.TopSites.rows;!t||!t[this.state.draggedIndex]||t[this.state.draggedIndex].url!==this.state.draggedSite.url||s[this.state.draggedIndex]&&s[this.state.draggedIndex].url===this.state.draggedSite.url||this.setState(Vt.DEFAULT_STATE)}}userEvent(e,t){this.props.dispatch(g.UserEvent({event:e,source:be,action_position:t}))}onDragEvent(e,t,s,n){switch(e.type){case"dragstart":this.dropped=!1,this.setState({draggedIndex:t,draggedSite:s,draggedTitle:n,activeIndex:null}),this.userEvent("DRAG",t);break;case"dragend":this.dropped||this.setState(Vt.DEFAULT_STATE);break;case"dragenter":t===this.state.draggedIndex?this.setState({topSitesPreview:null}):this.setState({topSitesPreview:this._makeTopSitesPreview(t)});break;case"drop":t!==this.state.draggedIndex&&(this.dropped=!0,this.props.dispatch(g.AlsoToMain({type:u.TOP_SITES_INSERT,data:{site:{url:this.state.draggedSite.url,label:this.state.draggedTitle,customScreenshotURL:this.state.draggedSite.customScreenshotURL,...this.state.draggedSite.searchTopSite&&{searchTopSite:!0}},index:t,draggedFromIndex:this.state.draggedIndex}})),this.userEvent("DROP",t))}}_getTopSites(){let e=this.props.TopSites.rows.slice();return e.length=8*this.props.TopSitesRows,this.props.mococnWideLayout&&(e.length/=2),e}_makeTopSitesPreview(e){const t=this._getTopSites();t[this.state.draggedIndex]=null;const s=t.map((e=>e&&(e.isPinned||Ut(e))?e:null)),n=t.filter((e=>e&&!e.isPinned&&!Ut(e))),o=Object.assign({},this.state.draggedSite,{isPinned:!0,isDragged:!0});if(s[e]){let t=e;const n=e>this.state.draggedIndex?-1:1;for(;s[t];)t+=n;const i=e>this.state.draggedIndex?1:-1;for(;e>this.state.draggedIndex?t<e:t>e;){let e=t+i;for(;Ut(s[e]);)e+=i;s[t]=s[e],t=e}s[e]=o}else s[e]=o;for(let e=0;e<s.length;e++)s[e]||(s[e]=n.shift()||null);return s}onActivate(e){this.setState({activeIndex:e})}render(){const{props:e}=this,t=this.state.topSitesPreview||this._getTopSites(),s=[],n={onDragEvent:this.onDragEvent,dispatch:e.dispatch};let o=0;const i=e.TopSitesRows*(e.mococnWideLayout?3:6);for(let r=0,a=t.length;r<a;r++){const a=t[r]&&Object.assign({},t[r],{iconType:this.props.topSiteIconType(t[r])}),c={key:a?a.url:o++,index:r};r>=i&&(c.className="hide-for-narrow"),e.mococnWideLayout&&(c.className=c.className?`${c.className} mococn-wide`:"mococn-wide"),s.push(a?P.createElement(Ft,Lt({link:a,activeIndex:this.state.activeIndex,onActivate:this.onActivate},c,n,{colors:e.colors})):P.createElement(Kt,Lt({},c,n)))}return P.createElement("ul",{className:"top-sites-list"+(this.state.draggedSite?" dnd-active":"")},s)}}class Ht extends P.PureComponent{constructor(e){super(e);const{site:t}=e;this.state={label:t?t.label||t.hostname:"",url:t?t.url:"",validationError:!1,customScreenshotUrl:t?t.customScreenshotURL:"",showCustomScreenshotForm:!!t&&t.customScreenshotURL},this.onClearScreenshotInput=this.onClearScreenshotInput.bind(this),this.onLabelChange=this.onLabelChange.bind(this),this.onUrlChange=this.onUrlChange.bind(this),this.onCancelButtonClick=this.onCancelButtonClick.bind(this),this.onClearUrlClick=this.onClearUrlClick.bind(this),this.onDoneButtonClick=this.onDoneButtonClick.bind(this),this.onCustomScreenshotUrlChange=this.onCustomScreenshotUrlChange.bind(this),this.onPreviewButtonClick=this.onPreviewButtonClick.bind(this),this.onEnableScreenshotUrlForm=this.onEnableScreenshotUrlForm.bind(this),this.validateUrl=this.validateUrl.bind(this)}onLabelChange(e){this.setState({label:e.target.value})}onUrlChange(e){this.setState({url:e.target.value,validationError:!1})}onClearUrlClick(){this.setState({url:"",validationError:!1})}onEnableScreenshotUrlForm(){this.setState({showCustomScreenshotForm:!0})}_updateCustomScreenshotInput(e){this.setState({customScreenshotUrl:e,validationError:!1}),this.props.dispatch({type:u.PREVIEW_REQUEST_CANCEL})}onCustomScreenshotUrlChange(e){this._updateCustomScreenshotInput(e.target.value)}onClearScreenshotInput(){this._updateCustomScreenshotInput("")}onCancelButtonClick(e){e.preventDefault(),this.props.onClose()}onDoneButtonClick(e){if(e.preventDefault(),this.validateForm()){const e={url:this.cleanUrl(this.state.url)},{index:t}=this.props;""!==this.state.label&&(e.label=this.state.label),this.state.customScreenshotUrl?e.customScreenshotURL=this.cleanUrl(this.state.customScreenshotUrl):this.props.site&&this.props.site.customScreenshotURL&&(e.customScreenshotURL=null),this.props.dispatch(g.AlsoToMain({type:u.TOP_SITES_PIN,data:{site:e,index:t}})),this.props.dispatch(g.UserEvent({source:be,event:"TOP_SITES_EDIT",action_position:t})),this.props.onClose()}}onPreviewButtonClick(e){e.preventDefault(),this.validateForm()&&(this.props.dispatch(g.AlsoToMain({type:u.PREVIEW_REQUEST,data:{url:this.cleanUrl(this.state.customScreenshotUrl)}})),this.props.dispatch(g.UserEvent({source:be,event:"PREVIEW_REQUEST"})))}cleanUrl(e){return e.startsWith("http:")||e.startsWith("https:")?e:`http://${e}`}_tryParseUrl(e){try{return new URL(e)}catch(e){return null}}validateUrl(e){const t=this._tryParseUrl(e)||this._tryParseUrl(this.cleanUrl(e));return t&&["http:","https:"].includes(t.protocol)}validateCustomScreenshotUrl(){const{customScreenshotUrl:e}=this.state;return!e||this.validateUrl(e)}validateForm(){const e=this.validateUrl(this.state.url)&&this.validateCustomScreenshotUrl();return e||this.setState({validationError:!0}),e}_renderCustomScreenshotInput(){const{customScreenshotUrl:e}=this.state,t=""===this.props.previewResponse,s=this.state.validationError&&!this.validateCustomScreenshotUrl()||t,n=s&&this.validateUrl(this.state.url)||!e,o=null===this.props.previewResponse&&e&&this.props.previewUrl===this.cleanUrl(e);return this.state.showCustomScreenshotForm?P.createElement("div",{className:"custom-image-input-container"},P.createElement(Pt,{errorMessageId:t?"newtab-topsites-image-validation":"newtab-topsites-url-validation",loading:o,onChange:this.onCustomScreenshotUrlChange,onClear:this.onClearScreenshotInput,shouldFocus:n,typeUrl:!0,value:e,validationError:s,titleId:"newtab-topsites-image-url-label",placeholderId:"newtab-topsites-url-input"})):P.createElement(st,{onClick:this.onEnableScreenshotUrlForm,className:"enable-custom-image-input","data-l10n-id":"newtab-topsites-use-image-link"})}render(){const{customScreenshotUrl:e}=this.state,t=""===this.props.previewResponse,s=!this.props.site,n=this.props.site&&this.props.site.customScreenshotURL||"",o=e&&this.cleanUrl(e)!==n&&!this.props.previewResponse,i=Object.assign({},this.props.site);this.props.previewResponse&&(i.screenshot=this.props.previewResponse,i.customScreenshotURL=this.props.previewUrl);const r=o?this.onPreviewButtonClick:this.onDoneButtonClick;return P.createElement("form",{className:"topsite-form",onSubmit:r},P.createElement("div",{className:"form-input-container"+(this.props.mococnWideLayout?" mococn-wide":"")},P.createElement("h3",{className:"section-title grey-title","data-l10n-id":s?"newtab-topsites-add-shortcut-header":"newtab-topsites-edit-shortcut-header"}),P.createElement("div",{className:"fields-and-preview"},P.createElement("div",{className:"form-wrapper"},P.createElement(Pt,{onChange:this.onLabelChange,value:this.state.label,titleId:"newtab-topsites-title-label",placeholderId:"newtab-topsites-title-input",autoFocusOnOpen:!0}),P.createElement(Pt,{onChange:this.onUrlChange,shouldFocus:this.state.validationError&&!this.validateUrl(this.state.url),value:this.state.url,onClear:this.onClearUrlClick,validationError:this.state.validationError&&!this.validateUrl(this.state.url),titleId:"newtab-topsites-url-label",typeUrl:!0,placeholderId:"newtab-topsites-url-input",errorMessageId:"newtab-topsites-url-validation"}),this._renderCustomScreenshotInput()),P.createElement(Bt,{link:i,className:this.props.mococnWideLayout?"mococn-wide":"",defaultStyle:t,title:this.state.label}))),P.createElement("section",{className:"actions"},P.createElement("button",{className:"cancel",type:"button",onClick:this.onCancelButtonClick,"data-l10n-id":"newtab-topsites-cancel-button"}),o?P.createElement("button",{className:"done preview",type:"submit","data-l10n-id":"newtab-topsites-preview-button"}):P.createElement("button",{className:"done",type:"submit","data-l10n-id":s?"newtab-topsites-add-button":"newtab-topsites-save-button"})))}}function Wt(){return Wt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Wt.apply(this,arguments)}function jt(e){return e.customScreenshotURL?"custom_screenshot":e.tippyTopIcon||"tippytop"===e.faviconRef?"tippytop":e.faviconSize>=96?"rich_icon":e.screenshot?"screenshot":"no_image"}Ht.defaultProps={site:null,index:-1};class $t extends P.PureComponent{get mococnWideLayout(){return M&&this.props.TopSites.rows.length<=12}constructor(e){super(e),this.onEditFormClose=this.onEditFormClose.bind(this)}_dispatchTopSitesStats(){const e=this._getVisibleTopSites().filter((e=>null!=e)),t=function(e){return e.reduce(((e,t)=>(e[jt(t)]++,e)),{custom_screenshot:0,screenshot:0,tippytop:0,rich_icon:0,no_image:0})}(e),s=e.filter((e=>!!e.isPinned)).length,n=e.filter((e=>!!e.searchTopSite)).length;this.props.dispatch(g.AlsoToMain({type:u.SAVE_SESSION_PERF_DATA,data:{topsites_icon_stats:t,topsites_pinned:s,topsites_search_shortcuts:n}}))}_getVisibleTopSites(){let e=8;return s.g.matchMedia("(min-width: 1072px)").matches||(e-=2),this.mococnWideLayout&&(e/=2),this.props.TopSites.rows.slice(0,this.props.TopSitesRows*e)}componentDidUpdate(){this._dispatchTopSitesStats()}componentDidMount(){this._dispatchTopSitesStats()}onEditFormClose(){this.props.dispatch(g.UserEvent({source:be,event:"TOP_SITES_EDIT_CLOSE"})),this.props.dispatch({type:u.TOP_SITES_CANCEL_EDIT})}render(){const{props:e}=this,{editForm:t,showSearchShortcutsForm:s}=e.TopSites,n=["AddTopSite"],o=e.Prefs.values["newNewtabExperience.colors"]||"#0090ED,#FF4F5F,#2AC3A2,#FF7139,#A172FF,#FFA437,#FF2A8A";return e.Prefs.values["improvesearch.topSiteSearchShortcuts"]&&n.push("AddSearchShortcut"),P.createElement(yt,{id:"topsites",initialized:e.TopSites.initialized,dispatch:e.dispatch},P.createElement(ct,{className:"top-sites",id:"topsites",title:e.title||{id:"newtab-section-header-topsites"},hideTitle:!0,extraMenuOptions:n,showPrefName:"feeds.topsites",eventSource:be,collapsed:!1,isFixed:e.isFixed,isFirst:e.isFirst,isLast:e.isLast,dispatch:e.dispatch},P.createElement(Vt,{TopSites:e.TopSites,TopSitesRows:e.TopSitesRows,dispatch:e.dispatch,mococnWideLayout:this.mococnWideLayout,topSiteIconType:jt,colors:o}),P.createElement("div",{className:"edit-topsites-wrapper"},t&&P.createElement("div",{className:"edit-topsites"},P.createElement(pt,{unstyled:!0,onClose:this.onEditFormClose,innerClassName:"modal"},P.createElement(Ht,Wt({site:e.TopSites.rows[t.index],onClose:this.onEditFormClose,dispatch:this.props.dispatch,mococnWideLayout:this.mococnWideLayout},t)))))))}}const Gt=(0,oe.$j)(((e,t)=>{let s=e.TopSites;if(M){let e=[];s.rows.forEach(((t,s)=>{t&&t.isPinned&&!t.searchTopSite&&(e[s]=t)})),s.rows=e}return{TopSites:s,Prefs:e.Prefs,TopSitesRows:e.Prefs.values.topSitesRows}}))($t);function Yt(){return Yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},Yt.apply(this,arguments)}const zt="visible",qt="visibilitychange";class Qt extends P.PureComponent{get numRows(){const{rowsPref:e,maxRows:t,Prefs:s}=this.props;return e?s.values[e]:t}_dispatchImpressionStats(){const{props:e}=this;let t=3;e.compactCards&&s.g.matchMedia("(min-width: 1072px)").matches&&(t=4);const n=t*this.numRows,o=e.rows.slice(0,n);this.needsImpressionStats(o)&&(e.dispatch(g.ImpressionStats({source:e.eventSource,tiles:o.map((e=>({id:e.guid})))})),this.impressionCardGuids=o.map((e=>e.guid)))}sendImpressionStatsOrAddListener(){const{props:e}=this;e.shouldSendImpressionStats&&e.dispatch&&(e.document.visibilityState===zt?this._dispatchImpressionStats():(this._onVisibilityChange&&e.document.removeEventListener(qt,this._onVisibilityChange),this._onVisibilityChange=()=>{e.document.visibilityState===zt&&(this.props.pref.collapsed||this._dispatchImpressionStats(),e.document.removeEventListener(qt,this._onVisibilityChange))},e.document.addEventListener(qt,this._onVisibilityChange)))}componentWillMount(){this.sendNewTabRehydrated(this.props.initialized)}componentDidMount(){this.props.rows.length&&!this.props.pref.collapsed&&this.sendImpressionStatsOrAddListener()}componentDidUpdate(e){const{props:t}=this,s=t.pref.collapsed,n=e.pref.collapsed;t.rows.length&&(t.rows!==e.rows&&!s||n&&!s)&&this.sendImpressionStatsOrAddListener()}componentWillUpdate(e){this.sendNewTabRehydrated(e.initialized)}componentWillUnmount(){this._onVisibilityChange&&this.props.document.removeEventListener(qt,this._onVisibilityChange)}needsImpressionStats(e){if(!this.impressionCardGuids||this.impressionCardGuids.length!==e.length)return!0;for(let t=0;t<e.length;t++)if(e[t].guid!==this.impressionCardGuids[t])return!0;return!1}sendNewTabRehydrated(e){e&&!this.renderNotified&&(this.props.dispatch(g.AlsoToMain({type:u.NEW_TAB_REHYDRATED,data:{}})),this.renderNotified=!0)}render(){const{id:e,eventSource:t,title:s,rows:n,Pocket:o,topics:i,emptyState:r,dispatch:a,compactCards:c,read_more_endpoint:l,contextMenuOptions:p,initialized:d,learnMore:h,pref:m,privacyNoticeURL:u,isFirst:E,isLast:S}=this.props,_="topstories"===e&&this.props.Pocket.waitingForSpoc,g=c?4:3,{numRows:v}=this,f=g*v,b=3*v,{pocketCta:C,isUserLoggedIn:y}=o||{},{useCta:k}=C||{},O=!0===y||!1===y,T=i&&!!i.length,w="topstories"===e&&T&&(k&&!0===y||!k&&O),I=l&&T,N=n.slice(0,f),R=d&&!n.length,A=[];if(!R)for(let e=0;e<f;e++){const s=N[e],n=e>=b?"hide-for-narrow":"";let o=!s;!o&&2===e&&_&&(o=!0),A.push(o?P.createElement(gt,{key:e,className:n}):P.createElement(_t,{key:e,index:e,className:n,dispatch:a,link:s,contextMenuOptions:p,eventSource:t,shouldSendImpressionStats:this.props.shouldSendImpressionStats,isWebExtension:this.props.isWebExtension}))}const D=["section",c?"compact-cards":"normal-cards"].join(" ");return P.createElement(yt,this.props,P.createElement(ct,{className:D,title:s,id:e,eventSource:t,collapsed:this.props.pref.collapsed,showPrefName:m&&m.feed||e,privacyNoticeURL:u,Prefs:this.props.Prefs,isFixed:this.props.isFixed,isFirst:E,isLast:S,learnMore:h,dispatch:this.props.dispatch,isWebExtension:this.props.isWebExtension},!R&&P.createElement("ul",{className:"section-list",style:{padding:0}},A),R&&P.createElement("div",{className:"section-empty-state"},P.createElement("div",{className:"empty-state"},P.createElement(Le,{message:r.message},P.createElement("p",{className:"empty-state-message"})))),"topstories"===e&&P.createElement("div",{className:"top-stories-bottom-container"},w&&P.createElement("div",{className:"wrapper-topics"},P.createElement(Tt,{topics:this.props.topics})),P.createElement("div",{className:"wrapper-more-recommendations"},I&&P.createElement(kt,{read_more_endpoint:l})))))}}Qt.defaultProps={document:s.g.document,rows:[],emptyState:{},pref:{},title:""};const Jt=(0,oe.$j)((e=>({Prefs:e.Prefs,Pocket:e.Pocket})))(Qt);class Xt extends P.PureComponent{renderSections(){const e=[],t=this.props.Sections.filter((e=>e.enabled)),{sectionOrder:s,"feeds.topsites":n}=this.props.Prefs.values,o=t.length+~~n;for(const i of s.split(",")){const s={key:i,isFirst:0===e.length,isLast:e.length===o-1};if("topsites"===i&&n)e.push(P.createElement(Gt,s));else{const n=t.find((e=>e.id===i));n&&e.push(P.createElement(Jt,Yt({},n,s)))}}return e}render(){return P.createElement("div",{className:"sections-list"},this.renderSections())}}const Zt=(0,oe.$j)((e=>{let t=e.Prefs,s=e.Sections;return M&&(t.values.sectionOrder="topsites,topstories",s=s.map((e=>{switch(e.id){case"highlights":e.enabled=!1;break;case"topstories":e.compactCards=!0,e.contextMenuOptions=["MoCoCNBlockUrl","Separator","OpenInNewWindow","OpenInPrivateWindow"],e.learnMore={link:{href:"",message:"​"}},e.privacyNoticeURL="",e.rows=e.rows.map((e=>(e.hostname=e.context,e))),e.title={id:"mococn-section-header-topstories"}}return e}))),{Sections:s,Prefs:t}}))(Xt);function es(){return es=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},es.apply(this,arguments)}class ts extends P.PureComponent{render(){const e=this.props.Sections.find((e=>"highlights"===e.id));return e&&e.enabled?P.createElement("div",{className:"ds-highlights sections-list"},P.createElement(Jt,es({},e,{isFixed:!0}))):null}}const ss=(0,oe.$j)((e=>({Sections:e.Sections})))(ts);class ns extends P.PureComponent{render(){return P.createElement("hr",{className:"ds-hr"})}}class os extends P.PureComponent{constructor(e){super(e),this.onLinkClick=this.onLinkClick.bind(this)}onLinkClick(e){this.props.dispatch&&this.props.dispatch(g.DiscoveryStreamUserEvent({event:"CLICK",source:"POPULAR_TOPICS",action_position:0,value:{topic:e.target.text.toLowerCase().replace(" ","-")}}))}render(){const{url:e,name:t}=this.props;return P.createElement(Pe,{onLinkClick:this.onLinkClick,className:this.props.className,url:e},t)}}class is extends P.PureComponent{render(){let e=this.props.links||[];const t=this.props.alignment||"centered",s=this.props.header||{},n=this.props.locale.startsWith("en-"),o=this.props.privacyNoticeURL||{},{newFooterSection:i}=this.props,r=`ds-navigation ds-navigation-${t} ${i?"ds-navigation-new-topics":""}`;let{title:a}=s;return i&&(a={id:"newtab-pocket-new-topics-title"},this.props.extraLinks&&(e=[...e.slice(0,e.length-1),...this.props.extraLinks,e[e.length-1]])),P.createElement("div",{className:r},a&&n?P.createElement(Le,{message:a},P.createElement("span",{className:"ds-navigation-header"})):null,n?P.createElement("ul",null,e&&e.map((e=>P.createElement("li",{key:e.name},P.createElement(os,{url:e.url,name:e.name,dispatch:this.props.dispatch}))))):null,i?null:P.createElement(Pe,{className:"ds-navigation-privacy",url:o.url},P.createElement(Le,{message:o.title})),i?P.createElement("div",{className:"ds-navigation-family"},P.createElement("span",{className:"icon firefox-logo"}),P.createElement("span",null,"|"),P.createElement("span",{className:"icon pocket-logo"}),P.createElement("span",{className:"ds-navigation-family-message","data-l10n-id":"newtab-pocket-pocket-firefox-family"})):null)}}class rs extends P.PureComponent{render(){const{properties:e}=this.props;return P.createElement("div",{className:"ds-privacy-link"},P.createElement(Pe,{url:e.url},P.createElement(Le,{message:e.title})))}}class as extends P.PureComponent{render(){const{header:{title:e,subtitle:t}}=this.props;return P.createElement("div",{className:"ds-section-title"},P.createElement("div",{className:"title"},e),t?P.createElement("div",{className:"subtitle"},t):null)}}const cs=["chrome://","resource://","https://img-getpocket.cdn.mozilla.net/"];class ls extends P.PureComponent{constructor(e){super(e),this.onStyleMount=this.onStyleMount.bind(this)}onStyleMount(e){if(!e)return;const{sheet:t}=e;JSON.parse(e.dataset.styles).forEach(((e,s)=>{e.forEach(((e,n)=>{e&&Object.entries(e).forEach((([e,o])=>{t.insertRule("DUMMY#CSS.SELECTOR {}");const[i]=t.cssRules;i.style=o,[...i.style].forEach((e=>{const t=i.style[e];(function(e,t){if(void 0===t)return!0;const s=t.match(/url\("[^"]+"\)/g);return!s||s.every((e=>cs.some((t=>e.slice(5).startsWith(t)))))})(0,t)||(console.error(`Bad CSS declaration ${e}: ${t}`),i.style.removeProperty(e))}));const r=`.ds-layout > .ds-column:nth-child(${s+1}) .ds-column-grid > :nth-child(${n+1})`;i.selectorText=e.split(",").map((e=>r+(":"===e[0]?"":" ")+e)).join(","),"DUMMY#CSS.SELECTOR"===i.selectorText&&console.error(`Bad CSS selector ${e}`)}))}))}))}renderComponent(e,t){var s;switch(e.type){case"Highlights":return P.createElement(ss,null);case"TopSites":return P.createElement("div",{className:"ds-top-sites"},P.createElement(Gt,{isFixed:!0,title:null===(s=e.header)||void 0===s?void 0:s.title}));case"TextPromo":return P.createElement(mt,{dispatch:this.props.dispatch,type:e.type,data:e.data});case"Signup":return P.createElement(ht,{dispatch:this.props.dispatch,type:e.type,data:e.data});case"Message":return P.createElement(lt,{title:e.header&&e.header.title,subtitle:e.header&&e.header.subtitle,link_text:e.header&&e.header.link_text,link_url:e.header&&e.header.link_url,icon:e.header&&e.header.icon,essentialReadsHeader:e.essentialReadsHeader,editorsPicksHeader:e.editorsPicksHeader});case"SectionTitle":return P.createElement(as,{header:e.header});case"Navigation":return P.createElement(is,{dispatch:this.props.dispatch,links:e.properties.links,extraLinks:e.properties.extraLinks,alignment:e.properties.alignment,explore_topics:e.properties.explore_topics,header:e.header,locale:this.props.App.locale,newFooterSection:e.newFooterSection,privacyNoticeURL:e.properties.privacyNoticeURL});case"CollectionCardGrid":const{DiscoveryStream:t}=this.props;return P.createElement(et,{data:e.data,feed:e.feed,spocs:t.spocs,placement:e.placement,type:e.type,items:e.properties.items,dismissible:this.props.DiscoveryStream.isCollectionDismissible,dispatch:this.props.dispatch});case"CardGrid":return P.createElement(Xe,{title:e.header&&e.header.title,data:e.data,feed:e.feed,widgets:e.widgets,type:e.type,dispatch:this.props.dispatch,items:e.properties.items,hybridLayout:e.properties.hybridLayout,hideCardBackground:e.properties.hideCardBackground,fourCardLayout:e.properties.fourCardLayout,compactGrid:e.properties.compactGrid,essentialReadsHeader:e.properties.essentialReadsHeader,editorsPicksHeader:e.properties.editorsPicksHeader,recentSavesEnabled:this.props.DiscoveryStream.recentSavesEnabled,hideDescriptions:this.props.DiscoveryStream.hideDescriptions});case"HorizontalRule":return P.createElement(ns,null);case"PrivacyLink":return P.createElement(rs,{properties:e.properties});default:return P.createElement("div",null,e.type)}}renderStyles(e){const t=JSON.stringify(e);return P.createElement("style",{key:t,"data-styles":t,ref:this.onStyleMount})}render(){const{locale:e}=this.props,{layoutRender:t}=(({state:e={},prefs:t={},locale:s=""})=>{const{layout:n,feeds:o,spocs:i}=e;let r={};const a={},c=[];t["feeds.topsites"]||c.push("TopSites"),t["feeds.section.topstories"]&&!1!==t["feeds.system.topstories"]||c.push("Message","TextPromo","SectionTitle","Signup","Navigation","CardGrid","CollectionCardGrid","HorizontalRule","PrivacyLink");const l=e=>{if(!e.feed)return{...e,data:{spocs:[]}};const t={recommendations:[]};let s=0;e.properties&&e.properties.items&&(s=e.properties.items);for(let e=0;e<s;e++)t.recommendations.push({placeholder:!0});return{...e,data:t}},p=(e,t)=>{let s=[...e];if(t.spocs&&t.spocs.positions&&t.spocs.positions.length){const e=(t.placement||{}).name||"spocs",n=i.data[e];i.loaded&&n&&n.items&&n.items.length&&(s=function(e,t,s,n){r[n]||0===r[n]||(r[n]=0);const o=[...e];for(let e of t.positions){const t=s[r[n]];if(!t)break;r[n]++,i.blocked.includes(t.url)||o.splice(e.index,0,t)}return o}(s,t.spocs,n.items,e))}return s},d=e=>{if(e.spocs&&e.spocs.positions&&e.spocs.positions.length){const t=(e.placement||{}).name||"spocs",s=i.data[t];if(i.loaded&&s&&s.items&&s.items.length)return{...e,data:{spocs:s.items.filter((e=>e&&!i.blocked.includes(e.url))).map(((e,t)=>({...e,pos:t})))}}}return{...e,data:{spocs:[]}}},h=e=>{a[e.type]=a[e.type]||0;let t={recommendations:[]};const s=o.data[e.feed.url];s&&s.data&&(t={...s.data,recommendations:[...s.data.recommendations||[]]}),e&&e.properties&&e.properties.offset&&(t={...t,recommendations:t.recommendations.slice(e.properties.offset)}),t={...t,recommendations:p(t.recommendations,e)};let n=0;e.properties&&e.properties.items&&(n=Math.min(e.properties.items,t.recommendations.length));for(let s=0;s<n;s++)t.recommendations[s]={...t.recommendations[s],pos:a[e.type]++};return{...e,data:t}};return{layoutRender:(()=>{const e=[];for(const t of n.filter((e=>e.components.filter((e=>!c.includes(e.type))).length))){let s=[];e.push({...t,components:s});for(const n of t.components.filter((e=>!c.includes(e.type)))){const t=n.spocs;if(t||n.feed){if(n.feed&&!o.data[n.feed.url]||t&&t.positions&&t.positions.length&&!i.loaded)return s.push(l(n)),e;n.feed?s.push(h(n)):s.push(d(n))}else s.push(n)}}return e})()}})({state:this.props.DiscoveryStream,prefs:this.props.Prefs.values,locale:e}),{config:s}=this.props.DiscoveryStream;if(t.length){const e=t[t.length-1];2===e.components.length&&e.components.every((e=>"MoCoCNPromo"===e.type))&&(t.length-=1)}if(!s.collapsible)return this.renderLayout(t);const n=e=>{for(const[s,n]of Object.entries(t))for(const[o,i]of Object.entries(n.components))if(i.type===e)return 1===n.components.length?t.splice(s,1):n.components.splice(o,1),i;return null},o=this.props.Sections.find((e=>"topstories"===e.id));if(!o)return null;M&&(o.privacyNoticeURL="");const i=n("TopSites"),r=n("CollectionCardGrid"),a=n("Message")||{header:{link_text:o.learnMore.link.message,link_url:o.learnMore.link.href,title:o.title}},c=n("PrivacyLink");let l={link:{href:a.header.link_url,message:a.header.link_text}},p=a.header.title,d="";return(a.essentialReadsHeader||a.editorsPicksHeader)&&(l=null,d="Recommended By Pocket",a.essentialReadsHeader?p="Today’s Essential Reads":a.editorsPicksHeader&&(p="Editor’s Picks")),P.createElement(P.Fragment,null,this.props.DiscoveryStream.isPrivacyInfoModalVisible&&P.createElement(dt,{dispatch:this.props.dispatch}),i&&this.renderLayout([{width:12,components:[i]}]),r&&this.renderLayout([{width:12,components:[r]}]),!!t.length&&P.createElement(ct,{className:"ds-layout",collapsed:o.pref.collapsed,dispatch:this.props.dispatch,id:o.id,isFixed:!0,learnMore:l,privacyNoticeURL:o.privacyNoticeURL,showPrefName:o.pref.feed,title:p,subTitle:d,eventSource:"CARDGRID"},this.renderLayout(t)),!M&&this.renderLayout([{width:12,components:[{type:"Highlights"}]}]),c&&this.renderLayout([{width:12,components:[c]}]))}renderLayout(e){const t=[];return P.createElement("div",{className:"discovery-stream ds-layout"},e.map(((e,s)=>P.createElement("div",{key:`row-${s}`,className:`ds-column ds-column-${e.width}`},P.createElement("div",{className:"ds-column-grid"},e.components.map(((n,o)=>n?(t[s]=[...t[s]||[],n.styles],P.createElement("div",{key:`component-${o}`},this.renderComponent(n,e.width))):null)))))),this.renderStyles(t))}}const ps=(0,oe.$j)((e=>({DiscoveryStream:e.DiscoveryStream,Prefs:e.Prefs,Sections:e.Sections,document:s.g.document,App:e.App})))(ls);class ds extends P.PureComponent{constructor(e){super(e),this.onClick=this.onClick.bind(this),this.onCloseSelf=this.onCloseSelf.bind(this)}getPrefKey(){return`redux.promo.${"skin"===this.props.type?"both":this.props.variant}.hideUntil`}normalize(e=0){if(isNaN(e))return 0;switch(this.props.variant){case"left":return 3*e+1;case"main":return 3*e+2;case"right":return 3*e+3;default:return 0}}onClick(e){e.preventDefault();const{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i}=e;this.props.dispatch(g.OnlyToMain({type:u.OPEN_LINK,data:{event:{altKey:t,button:s,ctrlKey:n,metaKey:o,shiftKey:i},url:this.props.url}})),this.props.dispatch(g.UserEvent({event:"CLICK",source:"MOCOCN_PROMO",action_position:this.normalize()}))}onCloseSelf(e){e.preventDefault(),e.stopPropagation();const t=this.getPrefKey(),s=this.props.MoCoCNPrefs.values[t],n=24*Math.ceil(this.props.shownUntil/24)+1;this.props.dispatch({type:u.MOCOCN_SET_PREF,data:{name:t,value:n}});const o=s&&Math.min(Math.round((n-s)/24),30);this.props.dispatch(g.UserEvent({event:"BLOCK",source:"MOCOCN_PROMO",action_position:this.normalize(o)}))}render(){const{MoCoCNPrefs:e,Prefs:t,Sections:s,TopSites:n,options:o,shownUntil:i,type:r,url:a,variant:c}=this.props,{[this.getPrefKey()]:l}=e.values,p=Date.now()/36e5,d=i&&p>i||p<l,h=t.values["feeds.topsites"]&&n.pref&&!0!==n.pref.collapsed,[m]=s.filter((e=>"topstories"===e.id)),u=m.enabled&&m.pref&&!0!==m.pref.collapsed,E=h||u;let S=[];switch(r){case"float":S.push(P.createElement("a",{className:"float_promo",href:a,onClick:this.onClick,style:{"--mococn-promo-float-bgimage":`url(${o.image})`,"--mococn-promo-float-height":o.imageHeight,"--mococn-promo-float-width":o.imageWidth}},P.createElement("button",{className:"closeSelf icon icon-dismiss",onClick:this.onCloseSelf})));break;case"skin":const e=[];for(let t=0,s=105;t<s;t++)e.push(P.createElement("li",null,t%2==0&&P.createElement("a",{href:a,onClick:this.onClick},P.createElement("div",{className:"background"}),P.createElement("div",{className:"foreground"})),15==t&&"right"==c&&P.createElement("button",{className:"closeSelf icon icon-dismiss",onClick:this.onCloseSelf})));S.push(P.createElement("ul",{className:"skin_promo",style:{"--mococn-promo-skin-background":`url(${o.imageBg})`,"--mococn-promo-skin-foreground":`url(${o.imageFg})`,"--mococn-promo-skin-height":o.imageHeight,"--mococn-promo-skin-width":o.imageWidth}},e))}return E&&P.createElement("aside",{"data-side":c},!d&&S)}}const hs=(0,oe.$j)((e=>({MoCoCNPrefs:e.MoCoCNPrefs,Prefs:e.Prefs,Sections:e.Sections,TopSites:e.TopSites})))(ds);class ms extends P.PureComponent{render(){return P.createElement("div",null)}}class us extends P.PureComponent{constructor(e){super(e),this.onPreferenceSelect=this.onPreferenceSelect.bind(this),this.topSitesDrawerRef=P.createRef(),this.pocketDrawerRef=P.createRef()}inputUserEvent(e,t){this.props.dispatch(g.UserEvent({event:"PREF_CHANGED",source:e,value:{status:t,menu_source:"CUSTOMIZE_MENU"}}))}onPreferenceSelect(e){let t=e.target.getAttribute("preference");const s=e.target.getAttribute("eventSource");let n;"SELECT"===e.target.nodeName?n=parseInt(e.target.value,10):"INPUT"===e.target.nodeName&&(n=e.target.checked,s&&this.inputUserEvent(s,n)),this.props.setPref(t,n)}componentDidMount(){this.setDrawerMargins()}componentDidUpdate(){this.setDrawerMargins()}setDrawerMargins(){this.setDrawerMargin("TOP_SITES",this.props.enabledSections.topSitesEnabled),this.setDrawerMargin("TOP_STORIES",this.props.enabledSections.pocketEnabled)}setDrawerMargin(e,t){let s;if("TOP_SITES"===e)s=this.topSitesDrawerRef.current;else{if("TOP_STORIES"!==e)return;s=this.pocketDrawerRef.current}s&&(s.style.marginTop=t?"0":"-100%")}render(){const{enabledSections:e,mayHaveSponsoredTopSites:t,pocketRegion:s,mayHaveSponsoredStories:n,mayHaveRecentSaves:o,openPreferences:i}=this.props,{topSitesEnabled:r,pocketEnabled:a,highlightsEnabled:c,showSponsoredTopSitesEnabled:l,showSponsoredPocketEnabled:p,showRecentSavesEnabled:d,topSitesRowsCount:h}=e,m=M?"mococn-custom-topstories-title":"newtab-custom-pocket-title",u=M?"mococn-custom-topstories-subtitle":"newtab-custom-pocket-subtitle";return P.createElement("div",{className:"home-section"},P.createElement("div",{id:"shortcuts-section",className:"section"},P.createElement("label",{className:"switch"},P.createElement("input",{id:"shortcuts-toggle",checked:r,type:"checkbox",onChange:this.onPreferenceSelect,preference:"feeds.topsites","aria-labelledby":"custom-shortcuts-title","aria-describedby":"custom-shortcuts-subtitle",eventSource:"TOP_SITES"}),P.createElement("span",{className:"slider",role:"presentation"})),P.createElement("div",null,P.createElement("h2",{id:"custom-shortcuts-title",className:"title"},P.createElement("label",{htmlFor:"shortcuts-toggle","data-l10n-id":"newtab-custom-shortcuts-title"})),P.createElement("p",{id:"custom-shortcuts-subtitle",className:"subtitle","data-l10n-id":"newtab-custom-shortcuts-subtitle"}),P.createElement("div",{className:"more-info-top-wrapper"},P.createElement("div",{className:"more-information",ref:this.topSitesDrawerRef},P.createElement("select",{id:"row-selector",className:"selector",name:"row-count",preference:"topSitesRows",value:h,onChange:this.onPreferenceSelect,disabled:!r,"aria-labelledby":"custom-shortcuts-title"},P.createElement("option",{value:"1","data-l10n-id":"newtab-custom-row-selector","data-l10n-args":'{"num": 1}'}),P.createElement("option",{value:"2","data-l10n-id":"newtab-custom-row-selector","data-l10n-args":'{"num": 2}'}),P.createElement("option",{value:"3","data-l10n-id":"newtab-custom-row-selector","data-l10n-args":'{"num": 3}'}),P.createElement("option",{value:"4","data-l10n-id":"newtab-custom-row-selector","data-l10n-args":'{"num": 4}'})),t&&P.createElement("div",{className:"check-wrapper",role:"presentation"},P.createElement("input",{id:"sponsored-shortcuts",className:"sponsored-checkbox",disabled:!r,checked:l,type:"checkbox",onChange:this.onPreferenceSelect,preference:"showSponsoredTopSites",eventSource:"SPONSORED_TOP_SITES"}),P.createElement("label",{className:"sponsored",htmlFor:"sponsored-shortcuts","data-l10n-id":"newtab-custom-sponsored-sites"})))))),s&&P.createElement("div",{id:"pocket-section",className:"section"},P.createElement("label",{className:"switch"},P.createElement("input",{id:"pocket-toggle",checked:a,type:"checkbox",onChange:this.onPreferenceSelect,preference:"feeds.section.topstories","aria-labelledby":"custom-pocket-title","aria-describedby":"custom-pocket-subtitle",eventSource:"TOP_STORIES"}),P.createElement("span",{className:"slider",role:"presentation"})),P.createElement("div",null,P.createElement("h2",{id:"custom-pocket-title",className:"title"},P.createElement("label",{htmlFor:"pocket-toggle","data-l10n-id":m})),P.createElement("p",{id:"custom-pocket-subtitle",className:"subtitle","data-l10n-id":u}),(n||o)&&P.createElement("div",{className:"more-info-pocket-wrapper"},P.createElement("div",{className:"more-information",ref:this.pocketDrawerRef},n&&P.createElement("div",{className:"check-wrapper",role:"presentation"},P.createElement("input",{id:"sponsored-pocket",className:"sponsored-checkbox",disabled:!a,checked:p,type:"checkbox",onChange:this.onPreferenceSelect,preference:"showSponsored",eventSource:"POCKET_SPOCS"}),P.createElement("label",{className:"sponsored",htmlFor:"sponsored-pocket","data-l10n-id":"newtab-custom-pocket-sponsored"})),o&&P.createElement("div",{className:"check-wrapper",role:"presentation"},P.createElement("input",{id:"recent-saves-pocket",className:"sponsored-checkbox",disabled:!a,checked:d,type:"checkbox",onChange:this.onPreferenceSelect,preference:"showRecentSaves",eventSource:"POCKET_RECENT_SAVES"}),P.createElement("label",{className:"sponsored",htmlFor:"recent-saves-pocket","data-l10n-id":"newtab-custom-pocket-show-recent-saves"})))))),!M&&P.createElement(P.Fragment,null,P.createElement("div",{id:"recent-section",className:"section"},P.createElement("label",{className:"switch"},P.createElement("input",{id:"highlights-toggle",checked:c,type:"checkbox",onChange:this.onPreferenceSelect,preference:"feeds.section.highlights",eventSource:"HIGHLIGHTS","aria-labelledby":"custom-recent-title","aria-describedby":"custom-recent-subtitle"}),P.createElement("span",{className:"slider",role:"presentation"})),P.createElement("div",null,P.createElement("h2",{id:"custom-recent-title",className:"title"},P.createElement("label",{htmlFor:"highlights-toggle","data-l10n-id":"newtab-custom-recent-title"})),P.createElement("p",{id:"custom-recent-subtitle",className:"subtitle","data-l10n-id":"newtab-custom-recent-subtitle"}))),P.createElement("span",{className:"divider",role:"separator"}),P.createElement("div",null,P.createElement("button",{id:"settings-link",className:"external-link",onClick:i,"data-l10n-id":"newtab-custom-settings"}))))}}class Es extends P.PureComponent{constructor(e){super(e),this.onEntered=this.onEntered.bind(this),this.onExited=this.onExited.bind(this)}onEntered(){this.closeButton&&this.closeButton.focus()}onExited(){this.openButton&&this.openButton.focus()}render(){return P.createElement("span",null,P.createElement(De.Z,{timeout:300,classNames:"personalize-animate",in:!this.props.showing,appear:!0},P.createElement("button",{className:"icon icon-settings personalize-button",onClick:()=>this.props.onOpen(),"data-l10n-id":"newtab-personalize-icon-label",ref:e=>this.openButton=e})),P.createElement(De.Z,{timeout:250,classNames:"customize-animate",in:this.props.showing,mountOnEnter:!0,onEntered:this.onEntered,onExited:this.onExited,appear:!0},P.createElement("div",{className:"customize-menu",role:"dialog","data-l10n-id":"newtab-personalize-dialog-label"},P.createElement("button",{onClick:()=>this.props.onClose(),className:"close-button","data-l10n-id":"newtab-custom-close-button",ref:e=>this.closeButton=e}),P.createElement(ms,null),P.createElement(us,{openPreferences:this.props.openPreferences,setPref:this.props.setPref,enabledSections:this.props.enabledSections,pocketRegion:this.props.pocketRegion,mayHaveSponsoredTopSites:this.props.mayHaveSponsoredTopSites,mayHaveSponsoredStories:this.props.DiscoveryStream.config.show_spocs,mayHaveRecentSaves:this.props.DiscoveryStream.recentSavesEnabled,dispatch:this.props.dispatch}))))}}const Ss=(0,oe.$j)((e=>({DiscoveryStream:e.DiscoveryStream})))(Es);function _s(){return _s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},_s.apply(this,arguments)}class gs extends P.PureComponent{constructor(e){super(e),this.onSearchClick=this.onSearchClick.bind(this),this.onSearchHandoffClick=this.onSearchHandoffClick.bind(this),this.onSearchHandoffPaste=this.onSearchHandoffPaste.bind(this),this.onSearchHandoffDrop=this.onSearchHandoffDrop.bind(this),this.onInputMount=this.onInputMount.bind(this),this.onInputMountHandoff=this.onInputMountHandoff.bind(this),this.onSearchHandoffButtonMount=this.onSearchHandoffButtonMount.bind(this)}handleEvent(e){"Search"===e.detail.type&&this.props.dispatch(g.UserEvent({event:"SEARCH"}))}onSearchClick(e){window.gContentSearchController.search(e)}doSearchHandoff(e){this.props.dispatch(g.OnlyToMain({type:u.HANDOFF_SEARCH_TO_AWESOMEBAR,data:{text:e}})),this.props.dispatch({type:u.FAKE_FOCUS_SEARCH}),this.props.dispatch(g.UserEvent({event:"SEARCH_HANDOFF"})),e&&this.props.dispatch({type:u.DISABLE_SEARCH})}onSearchHandoffClick(e){e.preventDefault(),this.doSearchHandoff()}onSearchHandoffPaste(e){e.preventDefault(),this.doSearchHandoff(e.clipboardData.getData("Text"))}onSearchHandoffDrop(e){e.preventDefault();let t=e.dataTransfer.getData("text");t&&this.doSearchHandoff(t)}componentWillUnmount(){delete window.gContentSearchController}onInputMount(e){if(e){const t=M||x?"newtab":"abouthome",s=M||x?"newtab":"homepage";window.gContentSearchController=new ContentSearchUIController(e,e.parentNode,t,s),addEventListener("ContentSearchClient",this)}else window.gContentSearchController=null,removeEventListener("ContentSearchClient",this)}onInputMountHandoff(e){e&&(this._handoffSearchController=new ContentSearchHandoffUIController)}getDefaultEngineName(){return this.props.Prefs.values["urlbar.placeholderName"]}getHandoffInputL10nAttributes(){let e=this.getDefaultEngineName();return e?{"data-l10n-id":"newtab-search-box-handoff-input","data-l10n-args":`{"engine": "${e}"}`}:{"data-l10n-id":"newtab-search-box-handoff-input-no-engine"}}getHandoffTextL10nAttributes(){let e=this.getDefaultEngineName();return e?{"data-l10n-id":"newtab-search-box-handoff-text","data-l10n-args":`{"engine": "${e}"}`}:{"data-l10n-id":"newtab-search-box-handoff-text-no-engine"}}onSearchHandoffButtonMount(e){this._searchHandoffButton=e}render(){const e=["search-wrapper",this.props.disable&&"search-disabled",this.props.fakeFocus&&"fake-focus"].filter((e=>e)).join(" ");return P.createElement("div",{className:e},this.props.showLogo&&P.createElement("div",{className:"logo-and-wordmark"},P.createElement("div",{className:"logo"}),P.createElement("div",{className:"wordmark"})),!this.props.handoffEnabled&&P.createElement("div",{className:"search-inner-wrapper",ref:this.onMoCoCNTargetMount},P.createElement("input",{id:"newtab-search-text","data-l10n-id":"newtab-search-box-input",maxLength:"256",ref:this.onInputMount,type:"search"}),P.createElement("button",{id:"searchSubmit",className:"search-button","data-l10n-id":"newtab-search-box-search-button",onClick:this.onSearchClick})),this.props.handoffEnabled&&P.createElement("div",{className:"search-inner-wrapper"},P.createElement("button",_s({className:"search-handoff-button"},this.getHandoffInputL10nAttributes(),{ref:this.onSearchHandoffButtonMount,onClick:this.onSearchHandoffClick,tabIndex:"-1"}),P.createElement("div",_s({className:"fake-textbox"},this.getHandoffTextL10nAttributes())),P.createElement("input",{type:"search",className:"fake-editable",tabIndex:"-1","aria-hidden":"true",onDrop:this.onSearchHandoffDrop,onPaste:this.onSearchHandoffPaste,ref:this.onInputMountHandoff}),P.createElement("div",{className:"fake-caret"}))))}}const vs=(0,oe.$j)((e=>({Prefs:e.Prefs})))(gs);function fs(){return fs=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},fs.apply(this,arguments)}class bs extends P.PureComponent{constructor(e){super(e),this.state={message:{}},this.notifyContent=this.notifyContent.bind(this)}notifyContent(e){this.setState(e)}componentWillUnmount(){this.updateTheme()}componentWillUpdate(){this.updateTheme()}updateTheme(){const e=["activity-stream",document.body.classList.contains("inline-onboarding")?"inline-onboarding":""].filter((e=>e)).join(" ");s.g.document.body.className=e}render(){const{props:e}=this,{App:t}=e;return t.initialized?P.createElement(rt,{className:"base-content-fallback"},P.createElement(P.Fragment,null,P.createElement(Cs,fs({},this.props,{adminContent:this.state})))):null}}class Cs extends P.PureComponent{constructor(e){super(e),this.openPreferences=this.openPreferences.bind(this),this.openCustomizationMenu=this.openCustomizationMenu.bind(this),this.closeCustomizationMenu=this.closeCustomizationMenu.bind(this),this.handleOnKeyDown=this.handleOnKeyDown.bind(this),this.onWindowScroll=function(e,t){let s;return(...t)=>{s||(s=setTimeout((()=>{s=null}),5),e.apply(this,t))}}(this.onWindowScroll.bind(this)),this.setPref=this.setPref.bind(this),this.state={fixedSearch:!1,customizeMenuVisible:!1},this.state.mococnShowLogo=!1,this.onIntersectionChange=this.onIntersectionChange.bind(this),this.onTargetMount=this.onTargetMount.bind(this)}componentDidMount(){s.g.addEventListener("scroll",this.onWindowScroll),s.g.addEventListener("keydown",this.handleOnKeyDown)}componentWillUnmount(){s.g.removeEventListener("scroll",this.onWindowScroll),s.g.removeEventListener("keydown",this.handleOnKeyDown)}onIntersectionChange(e,t){const[s]=e,n=1===s.intersectionRatio;this.setState({mococnShowLogo:n})}onTargetMount(e){IS_MOCOCN_NEWTAB&&(this.intersectionObserver||(this.intersectionObserver=new s.g.IntersectionObserver(this.onIntersectionChange,{rootMargin:"-211px 0px 0px",threshold:1})),e?this.intersectionObserver.observe(e):this.intersectionObserver.disconnect())}onWindowScroll(){const e=this.props.Prefs.values["logowordmark.alwaysVisible"]?179:34;s.g.scrollY>e&&!this.state.fixedSearch?this.setState({fixedSearch:!0}):s.g.scrollY<=e&&this.state.fixedSearch&&this.setState({fixedSearch:!1})}openPreferences(){this.props.dispatch(g.OnlyToMain({type:u.SETTINGS_OPEN})),this.props.dispatch(g.UserEvent({event:"OPEN_NEWTAB_PREFS"}))}openCustomizationMenu(){this.setState({customizeMenuVisible:!0}),this.props.dispatch(g.UserEvent({event:"SHOW_PERSONALIZE"}))}closeCustomizationMenu(){this.state.customizeMenuVisible&&(this.setState({customizeMenuVisible:!1}),this.props.dispatch(g.UserEvent({event:"HIDE_PERSONALIZE"})))}handleOnKeyDown(e){"Escape"===e.key&&this.closeCustomizationMenu()}setPref(e,t){this.props.dispatch(g.SetPref(e,t))}renderPromosFromDS(){const e=this.props.DiscoveryStream.layout;if(e.length<1)return null;const t=e[e.length-1];if(2!==t.components.length||!t.components.every((e=>"MoCoCNPromo"===e.type)))return null;const s=[];for(let e of t.components){const{options:t,shownUntil:n,type:o,url:i,variant:r}=e.properties;s.push(P.createElement(hs,{options:t,shownUntil:n,type:o,url:i,variant:r}))}return s}render(){const{props:e}=this,{App:t}=e,{initialized:s}=t,n=e.Prefs.values,o=e.DiscoveryStream.config&&e.DiscoveryStream.config.enabled;o||(this.setPref("discoverystream.config",JSON.stringify({collapsible:!0,enabled:!0,show_spocs:!1,hardcoded_layout:!1,personalized:!1,layout_endpoint:"https://newtab.firefoxchina.cn/newtab/ds/china-basic.json"})),this.setPref("discoverystream.enabled",!0));let i=e.Sections.filter((e=>"topstories"!==e.id));const r=n["feeds.section.topstories"]&&!1!==n["feeds.system.topstories"],a=!n["feeds.topsites"]&&!r&&0===i.filter((e=>e.enabled)).length,c=n["improvesearch.handoffToAwesomebar"],l=this.state.customizeMenuVisible,p={topSitesEnabled:n["feeds.topsites"],pocketEnabled:n["feeds.section.topstories"],highlightsEnabled:n["feeds.section.highlights"],showSponsoredTopSitesEnabled:n.showSponsoredTopSites,showSponsoredPocketEnabled:n.showSponsored,showRecentSavesEnabled:n.showRecentSaves,topSitesRowsCount:n.topSitesRows},d=!1!==n["feeds.system.topstories"],{mayHaveSponsoredTopSites:h}=n,m=["outer-wrapper",o&&r&&"ds-outer-wrapper-search-alignment",o&&"ds-outer-wrapper-breakpoint-override",n.showSearch&&this.state.fixedSearch&&!a&&"fixed-search",n.showSearch&&a&&"only-search",n["logowordmark.alwaysVisible"]&&"visible-logo"].filter((e=>e)).join(" "),u=n["feeds.snippets"]&&this.props.adminContent&&this.props.adminContent.message&&this.props.adminContent.message.id,E=o?this.renderPromosFromDS():null;return P.createElement("div",null,P.createElement(Ss,{onClose:this.closeCustomizationMenu,onOpen:this.openCustomizationMenu,openPreferences:this.openPreferences,setPref:this.setPref,enabledSections:p,pocketRegion:d,mayHaveSponsoredTopSites:h,showing:l}),P.createElement("div",{className:m,onClick:this.closeCustomizationMenu},P.createElement("main",{className:u?"has-snippet":""},n.showSearch&&P.createElement("div",{className:"non-collapsible-section"},P.createElement(rt,null,P.createElement(vs,fs({showLogo:a||n["logowordmark.alwaysVisible"]||this.state.mococnShowLogo,onMoCoCNTargetMount:this.onTargetMount,handoffEnabled:c},e.Search)))),P.createElement(ne,{adminContent:this.props.adminContent,appUpdateChannel:this.props.Prefs.values.appUpdateChannel,fxaEndpoint:this.props.Prefs.values.fxa_endpoint,dispatch:this.props.dispatch}),P.createElement("div",{className:"body-wrapper"+(s?" on":"")},o?P.createElement(rt,{className:"borderless-error"},P.createElement(ps,{locale:e.App.locale})):P.createElement(Zt,null)),P.createElement(re,null)),E||P.createElement(P.Fragment,null,P.createElement(hs,{type:"placeholder",variant:"left"}),P.createElement(hs,{type:"placeholder",variant:"right"}))))}}const ys=(0,oe.$j)((e=>{let t=e.Prefs;return t.values["improvesearch.handoffToAwesomebar"]=!1,t.values["logowordmark.alwaysVisible"]=!1,t.values.mayHaveSponsoredTopSites=!1,{App:e.App,Prefs:t,Sections:e.Sections,DiscoveryStream:e.DiscoveryStream,Search:e.Search}}))(bs),ks="visible",Os="visibilitychange";class Ts{constructor(e,t={}){this._store=e,this.document=t.document||s.g.document,this._perfService=t.perfService||bt,this._onVisibilityChange=this._onVisibilityChange.bind(this)}sendEventOrAddListener(){this.document.visibilityState===ks?this._sendEvent():this.document.addEventListener(Os,this._onVisibilityChange)}_sendEvent(){this._perfService.mark("visibility_event_rcvd_ts");try{let e=this._perfService.getMostRecentAbsMarkStartByName("visibility_event_rcvd_ts");this._store.dispatch(g.AlsoToMain({type:u.SAVE_SESSION_PERF_DATA,data:{visibility_event_rcvd_ts:e}}))}catch(e){}}_onVisibilityChange(){this.document.visibilityState===ks&&(this._sendEvent(),this.document.removeEventListener(Os,this._onVisibilityChange))}}var ws=s(5857);const Is="NEW_TAB_INITIAL_STATE",Ns=[u.SAVE_SESSION_PERF_DATA],Ps=e=>e=>t=>{const s=t.meta&&t.meta.skipLocal;v(t)&&RPMSendAsyncMessage("ActivityStream:ContentToMain",t),s||e(t)},Rs=e=>t=>n=>{if(n.type===u.MOCOCN_SET_PREF){s.g.localStorage&&s.g.localStorage.setItem(n.data.name,n.data.value);let t=Object.assign({},n,{type:u.MOCOCN_PREF_CHANGED});try{e.dispatch(t)}catch(e){console.error("Storage changed:",n,"Dispatch error: ",e)}}t(n)},As=({getState:e})=>(e.didRehydrate=!1,e.didRequestInitialState=!1,t=>s=>{if(e.didRehydrate||window.__FROM_STARTUP_CACHE__)return window.__FROM_STARTUP_CACHE__&&s.meta&&s.meta.isStartup?null:t(s);const n=s.type===Is;return s.type===u.NEW_TAB_STATE_REQUEST?(e.didRequestInitialState=!0,t(s)):n?(e.didRehydrate=!0,t(s)):e.didRequestInitialState&&s.type===u.INIT?t(g.AlsoToMain({type:u.NEW_TAB_STATE_REQUEST})):f(s)||b(s)||C(s)?null:t(s)}),Ds=({getState:e})=>(e.earlyActionQueue=[],e.receivedFromMain=!1,t=>s=>{e.receivedFromMain?t(s):y(s)?(t(s),e.receivedFromMain=!0,e.earlyActionQueue.forEach(t),e.earlyActionQueue.length=0):Ns.includes(s.type)?e.earlyActionQueue.push(s):t(s)});s(7923).S({beforeSend(e,t){try{if(t&&t.originalException&&"Element is not a row"===t.originalException.message){let[t]=e.extra.arguments;if("mouseout"===t.type&&["table#searchSuggestionTable.contentSearchSuggestionTable","table.contentSearchOneOffsTable.contentSearchSuggestionsContainer"].includes(t.target))return null}}catch(e){s.g.console.error(e)}return e},denyUrls:[/^moz-extension:\/\//i],dsn:"https://caa51ba7ccc74712a62dadc11a809e6a@o1069899.ingest.sentry.io/6249939",environment:"production",release:"firefox-109.0b9-42-g868ffa4-dirty",sampleRate:.005});const Ls=({store:e})=>P.createElement(oe.zt,{store:e},P.createElement(ys,null));!function(){const e=function(e,t){const n=(0,ws.MT)((o=(0,ws.UY)(e),(e,t)=>t.type===Is?{...e,...t.data}:o(e,t)),t,s.g.RPMAddMessageListener&&(0,ws.md)(Ds,As,Ps,Rs));var o;if(s.g.RPMAddMessageListener&&s.g.RPMAddMessageListener("ActivityStream:MainToContent",(e=>{try{n.dispatch(e.data)}catch(t){console.error("Content msg:",e,"Dispatch error: ",t),dump(`Content msg: ${JSON.stringify(e)}\nDispatch error: ${t}\n${t.stack}`)}})),s.g.localStorage){const e="redux.";s.g.addEventListener("storage",(t=>{if(!t.key.startsWith(e)||t.oldValue===t.newValue)return;let s={type:u.MOCOCN_PREF_CHANGED,data:{name:t.key,value:t.newValue}};try{n.dispatch(s)}catch(e){console.error("Storage changed:",s,"Dispatch error: ",e),dump(`Storage changed: ${JSON.stringify(s)}\nDispatch error: ${e}\n${e.stack}`)}}))}return n}(Nt);!function(e){if(s.g.localStorage)try{let t={};for(let e of["redux.promo.both.hideUntil","redux.promo.left.hideUntil","redux.promo.right.hideUntil"])try{t[e]=JSON.parse(s.g.localStorage.getItem(e)||"0")}catch(s){t[e]=0}e.dispatch({type:u.MOCOCN_PREFS_INITIAL_VALUES,data:t})}catch(e){console.error("Dispatch error: ",e),dump(`Dispatch error: ${e}\n${e.stack}`)}}(e),new Ts(e).sendEventOrAddListener();let t=!1,n=0;function o(){t||(n&&cancelIdleCallback(n),t=!0,e.dispatch(g.AlsoToMain({type:u.NEW_TAB_STATE_REQUEST})))}document.hidden?(n=requestIdleCallback(o),addEventListener("visibilitychange",o,{once:!0})):o(),B.hydrate(P.createElement(Ls,{store:e}),document.getElementById("root"))}(),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("service-worker.js").then((e=>{s.g.console.log("SW registered: ",e)})).catch((e=>{s.g.console.log("SW registration failed: ",e)}))}))}},o={};function i(e){var t=o[e];if(void 0!==t)return t.exports;var s=o[e]={id:e,loaded:!1,exports:{}};return n[e](s,s.exports,i),s.loaded=!0,s.exports}i.m=n,e=[],i.O=(t,s,n,o)=>{if(!s){var r=1/0;for(p=0;p<e.length;p++){for(var[s,n,o]=e[p],a=!0,c=0;c<s.length;c++)(!1&o||r>=o)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(a=!1,o<r&&(r=o));if(a){e.splice(p--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var p=e.length;p>0&&e[p-1][2]>o;p--)e[p]=e[p-1];e[p]=[s,n,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,s)=>(i.f[s](e,t),t)),[])),i.u=e=>({745:"en-US",822:"zh-CN"}[e]+"."+{745:"e4cf9696f631423077f0",822:"5064baad1864cc84c32b"}[e]+".js"),i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},s="activity-streams:",i.l=(e,n,o,r)=>{if(t[e])t[e].push(n);else{var a,c;if(void 0!==o)for(var l=document.getElementsByTagName("script"),p=0;p<l.length;p++){var d=l[p];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==s+o){a=d;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",s+o),a.src=e,0!==a.src.indexOf(window.location.origin+"/")&&(a.crossOrigin="anonymous"),a.integrity=i.sriHashes[r],a.crossOrigin="anonymous"),t[e]=[n];var h=(s,n)=>{a.onerror=a.onload=null,clearTimeout(m);var o=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(n))),s)return s(n)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),i.sriHashes={745:"sha512-U2RqQsMItlLoyGUI1jena+fU9hsU82gAF+XvmUqCiuddJGH5Pu1q1DqvmuwFPVkEfP97aDMv/RTh8wan3tDsRg==",822:"sha512-mV79PF9gK7zYIDkVT/1vzkFKiIcythHxOS9NbNQwGjoJASrCXkhbJdycyzTURm4exZrfwBDRuICHCygQE14hyg=="},(()=>{var e={840:0};i.f.j=(t,s)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var o=new Promise(((s,o)=>n=e[t]=[s,o]));s.push(n[2]=o);var r=i.p+i.u(t),a=new Error;i.l(r,(s=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var o=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",a.name="ChunkLoadError",a.type=o,a.request=r,n[1](a)}}),"chunk-"+t,t)}},i.O.j=t=>0===e[t];var t=(t,s)=>{var n,o,[r,a,c]=s,l=0;if(r.some((t=>0!==e[t]))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(c)var p=c(i)}for(t&&t(s);l<r.length;l++)o=r[l],i.o(e,o)&&e[o]&&e[o][0](),e[r[l]]=0;return i.O(p)},s=self.webpackChunkactivity_streams=self.webpackChunkactivity_streams||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=i.O(void 0,[216,55],(()=>i(8059)));r=i.O(r)})();
//# sourceMappingURL=activity-stream.d083cf70a13d5b3a330d.js.map